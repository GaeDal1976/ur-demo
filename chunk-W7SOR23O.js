import{a as Ct}from"./chunk-QU5P5LVV.js";import{a as ht}from"./chunk-ZH2XUZEO.js";import{A as Y,B as $,C as tt,Ha as g,Ia as _t,Ja as ft,Ka as Et,P as et,aa as ot,ba as it,ca as rt,da as nt,ea as st,fa as at,ga as ct,ha as lt,ia as ut,ja as mt,ka as pt,m as B,p as U,r as W,s as Z,t as q,u as Q,ua as dt,v as G,w as X,x as z,y as J,z as K}from"./chunk-CU3LUQIR.js";import{b as H,c as d,d as P}from"./chunk-737PEWWY.js";import{L as k}from"./chunk-VYBD7QQC.js";import{e as x,t as V,v as j,w as M}from"./chunk-KODN66SN.js";import{$ as c,Aa as u,Bb as v,Cb as w,Db as D,Fa as m,K as h,Ka as L,Qa as A,Qb as F,Xa as p,aa as l,db as r,eb as a,fb as R,i as y,jb as S,nb as b,ob as f,xb as E,yb as N}from"./chunk-P6AE7GFT.js";var I="Crea Nuovo Sconto",O=[ot,it,rt,nt,st,at,ct,lt,ut,mt,pt,dt],T={validators:[],controls:[Z,q,Q,G,X,z,J,K,Y,$,tt,et]};function At(n,bt){if(n&1){let t=S();r(0,"div",4)(1,"div",5)(2,"h1",6),E(3),a(),r(4,"a",7)(5,"button",8),R(6,"span",9),r(7,"span"),E(8,"Indietro"),a()()()(),r(9,"app-form",10),b("dispacther",function(e){c(t);let i=f();return l(i.onFormEvent(e))}),a(),r(10,"div",11),R(11,"div",12),r(12,"div",13)(13,"button",14),b("click",function(){c(t);let e=f();return l(e.showDialogNewDiscount=!0)}),E(14," Aggiungi Sconto "),a()()(),r(15,"app-table",15),D("selectedRowsChange",function(e){c(t);let i=f();return w(i.selectedRows,e)||(i.selectedRows=e),l(e)}),a()()}if(n&2){let t=f();u(3),N(t.table.label),u(6),p("form",t.searchForm)("options",t.optionsFrom),u(4),p("disabled",!t.selectedRows.length),u(2),p("headers",t.table.headers)("data",t.filterdTableData),v("selectedRows",t.selectedRows)}}function Rt(n,bt){n&1&&(r(0,"h1",16),E(1,"Aggiungi Sconto"),a())}var Wt=(()=>{class n{scontiService;route;router;infoCarService;notification;store;optionsFrom;searchForm;table;filterdTableData;showDialogNewDiscount;selectedRows;form;formSubmitted;destroySubject=new y;disountType=W.Costruttore;constructor(t,o,e,i,_,s){this.scontiService=t,this.route=o,this.router=e,this.infoCarService=i,this.notification=_,this.store=s,this.table={data:[],label:I,headers:O},this.filterdTableData=[]}ngOnInit(){this.selectedRows=[],this.showDialogNewDiscount=!1,this.searchForm=_t(T,this.route.snapshot.queryParams);let t={};this.searchForm.controls.forEach(e=>{t[e.name]=e.default}),Object.keys(t).some(e=>!!t[e])&&this.onFilterSubmit(t),this.subscribeAutocomplition()}onFormEvent(t){let{type:o,payload:e}=t;switch(o){case g.FormSubmit:this.onFilterSubmit(e);break;case g.FormAutocomplete:this.optionsFrom[e.name]||this.fetchAutoCompletion(e.name)}}onFilterSubmit(t){let o={},e=this.searchForm.controls.map(i=>i.name);e.filter(i=>t[i]!=null).forEach(i=>o[i]=t[i]),this.router.navigate([],{queryParams:o}),this.fetchCars(()=>{let i=s=>{for(let C of e)if(t[C]!=null&&t[C]!=""&&t[C]!=s[C])return!1;return!0},_=this.table.data.filter(i);this.filterdTableData=_})}onAddNewDiscount(t){let o=this.selectedRows.length;this.showDialogNewDiscount=!1,this.notification.show({severity:"success",summary:"Soncto Costruttore",detail:"\xE8 stato aggiunto "+(o>1?o+" soncti":"soncto")+ +" costruttore con sucesso"}),this.router.navigateByUrl("sconti/costruttore")}fetchCars(t){let o={"X-UNIPOL-REQUESTID":crypto.randomUUID()};this.scontiService.getVeicoli(o).pipe(h(this.destroySubject)).subscribe({next:e=>{this.table={data:e,label:I,headers:O},this.filterdTableData=[...this.table.data],d.print("getScontiCostruttore","result",e),t&&t()},error:e=>{d.print("getScontiCostruttore","error",e)},complete:()=>{d.print("getScontiCostruttore","complete")}})}fetchAutoCompletion(t){this.infoCarService.autoComplete(t).pipe(h(this.destroySubject)).subscribe({next:o=>{this.store.setCarOptions(t,o),d.print("fetchAutoCompletion","result",t)},error:o=>{d.print("fetchAutoCompletion","error",t)},complete:()=>{d.print("fetchAutoCompletion","complete",t)}})}subscribeAutocomplition(){let t=T.controls.filter(o=>o.autocomplete).map(o=>o.name);this.store.subscribeCarAutoComplition(t).pipe(h(this.destroySubject)).subscribe(o=>{this.optionsFrom=o})}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}static \u0275fac=function(o){return new(o||n)(m(H),m(V),m(j),m(P),m(ht),m(k))};static \u0275cmp=L({type:n,selectors:[["app-sconto-nuovo"]],decls:5,vars:4,consts:[["header",""],["class","sconto-construttore-nuovo page",4,"ngIf"],[3,"visibleChange","modal","visible"],[3,"cancel","submit","type"],[1,"sconto-construttore-nuovo","page"],[1,"flex","flex-row","justify-between","items-center"],[1,"text-4xl"],["routerLink","/sconti/costruttore","routerLinkActive","router-link-active","routerLinkActive","router-link-active"],[1,"ur-button","flex","justify-between","items-center","gap-2"],[1,"pi","pi-arrow-left"],["clearButton","Rimuovi filtri","buttonLabel","Cerca",3,"dispacther","form","options"],[1,"action","flex"],[1,"flex","justify-start"],[1,"flex","justify-end"],["type","button",1,"ur-button","accent",3,"click","disabled"],[3,"selectedRowsChange","headers","data","selectedRows"],[1,"text-2xl"]],template:function(o,e){if(o&1){let i=S();A(0,At,16,7,"div",1),r(1,"p-dialog",2),D("visibleChange",function(s){return c(i),w(e.showDialogNewDiscount,s)||(e.showDialogNewDiscount=s),l(s)}),A(2,Rt,2,0,"ng-template",null,0,F),r(4,"add-sconto",3),b("cancel",function(){return c(i),l(e.showDialogNewDiscount=!1)})("submit",function(s){return c(i),l(e.onAddNewDiscount(s))}),a()()}o&2&&(p("ngIf",e.table),u(),p("modal",!0),v("visible",e.showDialogNewDiscount),u(3),p("type",e.disountType))},dependencies:[x,M,U,ft,B,Ct,Et],styles:[".action[_ngcontent-%COMP%]{justify-content:space-between;padding-bottom:2rem}.form-group[_ngcontent-%COMP%]{flex:1 1 0}"]})}return n})();export{Wt as ScontoCostruttoreNuovoComponent};
