import{a as W}from"./chunk-2P6QCPOT.js";import{a as We,b as ze}from"./chunk-7QMZ3LNE.js";import{a as qe}from"./chunk-JDFJ6QK4.js";import"./chunk-5OKU2XER.js";import{A as ne,B as re,C as ae,D as se,E as le,F as ce,G as pe,H as _e,Ha as A,I as me,Ia as Ge,J as de,Ja as Be,K as ue,Ka as Ze,La as Qe,M as Ee,O as Ce,Q as Se,R as Re,aa as he,ba as fe,ca as Ae,da as De,ea as Te,fa as Ie,ga as ge,ha as Oe,ia as be,ja as we,ka as Le,la as ye,m as q,ma as ve,na as xe,oa as Fe,p as X,pa as Pe,q as f,ra as Ve,s as J,sa as Ne,t as K,ta as Me,u as Y,v as $,w as ee,wa as He,x as te,xa as ke,y as ie,ya as Ue,z as oe,za as je}from"./chunk-LRR7SAV4.js";import{b as B,c as E,d as Z}from"./chunk-F5O3EZP7.js";import{D as w,E as L,G as Q,g as z,t as F}from"./chunk-XHWAPZXS.js";import{e as k,i as U,u as j,w as G}from"./chunk-MCQEVFIB.js";import{$ as _,Aa as s,Ab as x,Bb as I,Cb as g,Db as O,Fa as h,Fb as H,K as T,Ka as N,Qa as S,Qb as b,Xa as l,a as D,aa as m,b as v,db as r,eb as a,i as V,jb as R,nb as u,ob as c,xb as d,yb as M}from"./chunk-JC545UEF.js";var Xe="Piano di supporto",Je=[He,ke,he,fe,De,xe,Fe,Me,Ue,je,Ae,Te,Ie,ge,Oe,be,we,Le,ye,ve,Pe,Ne,Ve],P={validators:[],controls:[Se,Re,J,K,Y,$,ee,te,ie,oe,ne,re,ae,se,le,ce,pe,_e,me,de,ue,Ee,Ce]};var Ke=()=>["nuovo"];function Ye(o,C){if(o&1&&(r(0,"div",19)(1,"p-message",20),d(2),a()()),o&2){let e=c(2);s(2),x("\xE8 stato selezionato ",e.selectedClients.length," ",e.clientType,"")}}function $e(o,C){if(o&1){let e=R();r(0,"div",8)(1,"h1",9),d(2),a(),r(3,"app-form",10),u("dispacther",function(i){_(e);let n=c();return m(n.onFormEvent(i))}),a(),S(4,Ye,3,2,"div",11),r(5,"div",12)(6,"div",13)(7,"button",14)(8,"a",15),d(9," Crea Nuovo Sconto "),a()()(),r(10,"div",16)(11,"button",17),u("click",function(){_(e);let i=c();return m(i.showDialogEditValidityDate=!0)}),d(12," Modifica Fine Validit\xE0 "),a(),r(13,"button",17),u("click",function(){_(e);let i=c();return m(i.showDialogRemoveDiscounts=!0)}),d(14," Eliminazione Sconto "),a()()(),r(15,"app-table",18),O("selectedRowsChange",function(i){_(e);let n=c();return g(n.selectedRows,i)||(n.selectedRows=i),m(i)}),a()()}if(o&2){let e=c();s(2),M(e.table.label),s(),l("form",e.searchForm)("options",e.optionsFrom),s(),l("ngIf",e.selectedClients),s(4),l("routerLink",H(11,Ke)),s(3),l("disabled",!e.selectedRows.length),s(2),l("disabled",!e.selectedRows.length),s(2),l("numberOfDisplayedColumns",8)("headers",e.table.headers)("data",e.filterdTableData),I("selectedRows",e.selectedRows)}}function et(o,C){if(o&1){let e=R();r(0,"edit-validity-date-modal",21),u("cancel",function(){_(e);let i=c();return m(i.showDialogEditValidityDate=!1)})("select",function(i){_(e);let n=c();return m(n.onSelectDiscountValidity(i))}),a()}}function tt(o,C){o&1&&(r(0,"div",22)(1,"h2",23),d(2,"Elimina Sconto"),a()())}function it(o,C){if(o&1){let e=R();r(0,"div",24)(1,"button",25),u("click",function(){_(e);let i=c();return m(i.showDialogRemoveDiscounts=!1)}),d(2," Annulla "),a(),r(3,"button",26),u("click",function(){_(e);let i=c();return m(i.onRemoveDiscounts())}),d(4," Conferma "),a()()}}function ot(o,C){o&1&&(r(0,"h1",9),d(1,"Cerca Cliente"),a())}function nt(o,C){if(o&1){let e=R();r(0,"search-client",27),u("select",function(i){_(e);let n=c();return m(n.onSelectClients(i))}),a()}if(o&2){let e=c();l("type",e.clientType)}}var yt=(()=>{class o{scontiService;infoCarService;store;route;searchForm;optionsFrom;selectedRows;table;filterdTableData;showDialogEditValidityDate;showDialogRemoveDiscounts;showDialogSearchClient;clientType;selectedClients;today=new Date;destroySubject=new V;constructor(e,t,i,n){this.scontiService=e,this.infoCarService=t,this.store=i,this.route=n}ngOnInit(){this.selectedRows=new Array,this.showDialogRemoveDiscounts=!1,this.showDialogEditValidityDate=!1,this.showDialogSearchClient=!1,this.searchForm=Ge(P,this.route.snapshot.queryParams),this.fetchScontiDS(),this.subscribeAutocomplition()}onFormEvent({type:e,payload:t}){switch(e){case A.FormSubmit:this.filterScontiDS(t);break;case A.FormLookup:t?.name==L&&(this.clientType=f.Cliente),t?.name==w&&(this.clientType=f.CapoGruppo),this.showDialogSearchClient=!0;break;case A.FormChange:this.onFilterChange(t);break;case A.FormAutocomplete:this.optionsFrom[t.name]||this.fetchAutoCompletion(t.name)}}onFilterChange(e){this.searchForm.controls.forEach(t=>t.default=e[t.name]),!e[L]&&!e[w]&&(this.selectedClients=null),this.searchForm=D({},this.searchForm)}onRemoveDiscounts(){this.showDialogRemoveDiscounts=!1,this.filterdTableData=this.filterdTableData.filter(e=>!this.selectedRows.find(t=>t.id==e.id)),this.selectedRows.splice(0)}onSelectDiscountValidity(e){let t=ze.parseDateToString(e,"yyyy-MM-dd");this.showDialogEditValidityDate=!1,this.filterdTableData=this.filterdTableData.map(i=>this.selectedRows.find(n=>n.id==i.id)?v(D({},i),{[F]:t}):i),this.selectedRows=this.selectedRows.map(i=>v(D({},i),{[F]:t}))}onSelectClients(e){let t="Selezione Multipla";if(e.length==1){let n=this.clientType==f.Cliente?Q:z;t=e[0][n]}this.showDialogSearchClient=!1,this.selectedClients=e;let i=this.clientType==f.Cliente?L:w;this.onFilterChange({[i]:t})}filterScontiDS(e){if(!e){this.filterdTableData=this.table.data;return}let t=Object.keys(e),i=y=>{for(let p of t)if(e[p]!=null&&e[p]!=""&&e[p]!=y[p])return!1;return!0},n=this.table.data.filter(i);this.filterdTableData=n}fetchScontiDS(){let e={"X-UNIPOL-REQUESTID":crypto.randomUUID()};this.scontiService.getScontipianoDiSupporto(e).pipe(T(this.destroySubject)).subscribe({next:t=>{this.table={data:t,label:Xe,headers:Je},this.filterdTableData=[...t],E.print("getScontiCostruttore","result",t)},error:t=>{E.print("getScontiCostruttore","error",t)},complete:()=>{E.print("getScontiCostruttore","complete")}})}fetchAutoCompletion(e){this.infoCarService.autoComplete(e).pipe(T(this.destroySubject)).subscribe({next:t=>{this.store.setCarOptions(e,t),E.print("fetchAutoCompletion","result",e)},error:t=>{E.print("fetchAutoCompletion","error",e)},complete:()=>{E.print("fetchAutoCompletion","complete",e)}})}subscribeAutocomplition(){let e=P.controls.filter(t=>t.autocomplete).map(t=>t.name);this.store.subscribeCarAutoComplition(e).pipe(T(this.destroySubject)).subscribe(t=>{this.optionsFrom=t})}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}static \u0275fac=function(t){return new(t||o)(h(B),h(Z),h(Qe),h(j))};static \u0275cmp=N({type:o,selectors:[["app-sconti-piano-supporto"]],decls:16,vars:9,consts:[["header",""],["footer",""],["class","sconto-construttore page",4,"ngIf"],[3,"cancel","select",4,"ngIf"],[3,"visibleChange","modal","visible"],[1,"flex","flex-col","gap-4","mb-4"],[1,"mb-3"],[3,"type","select",4,"ngIf"],[1,"sconto-construttore","page"],[1,"text-4xl"],["clearButton","Rimuovi filtri","buttonLabel","Cerca",3,"dispacther","form","options"],["class","pb-4",4,"ngIf"],[1,"action","flex"],[1,"flex","gap-2","justify-start"],[1,"ur-button","accent"],["routerLinkActive","router-link-active",1,"ur-a",3,"routerLink"],[1,"flex","gap-2","justify-end"],["type","button",1,"ur-button","secondary",3,"click","disabled"],[3,"selectedRowsChange","numberOfDisplayedColumns","headers","data","selectedRows"],[1,"pb-4"],["icon","pi pi-check-circle","severity","info","variant","outlined"],[3,"cancel","select"],[1,"inline-flex","items-center","justify-center","gap-2"],[1,"text-2xl"],[1,"flex","justify-between","w-full"],["type","button",1,"ur-button","secondary",3,"click"],["type","button",1,"ur-button","accent",3,"click"],[3,"select","type"]],template:function(t,i){if(t&1){let n=R();S(0,$e,16,12,"div",2)(1,et,1,0,"edit-validity-date-modal",3),r(2,"p-dialog",4),O("visibleChange",function(p){return _(n),g(i.showDialogRemoveDiscounts,p)||(i.showDialogRemoveDiscounts=p),m(p)}),S(3,tt,3,0,"ng-template",null,0,b),r(5,"div",5)(6,"p",6),d(7,"Verr\xE0 Eliminato lo sconto da CPQ !"),a(),r(8,"p",6),d(9),a()(),S(10,it,5,0,"ng-template",null,1,b),a(),r(12,"p-dialog",4),O("visibleChange",function(p){return _(n),g(i.showDialogSearchClient,p)||(i.showDialogSearchClient=p),m(p)}),S(13,ot,2,0,"ng-template",null,0,b)(15,nt,1,1,"search-client",7),a()}t&2&&(l("ngIf",i.table),s(),l("ngIf",i.showDialogEditValidityDate),s(),l("modal",!0),I("visible",i.showDialogRemoveDiscounts),s(7),x(" Hai selezionato ",i.selectedRows.length," ",i.selectedRows.length==1?"sconto":"sconti"," "),s(3),l("modal",!0),I("visible",i.showDialogSearchClient),s(3),l("ngIf",i.showDialogSearchClient))},dependencies:[U,k,Be,Ze,q,G,X,We,qe,W],styles:[".action[_ngcontent-%COMP%]{justify-content:space-between;padding-bottom:2rem}.form-group[_ngcontent-%COMP%]{flex:1 1 0}"]})}return o})();export{yt as ScontiPianoSupportoComponent};
