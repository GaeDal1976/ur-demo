import{a as K}from"./chunk-4GIPYPIS.js";import{a as Qe,b as ze}from"./chunk-LZPMS7K5.js";import{a as Y}from"./chunk-HNRD2T62.js";import{a as Je}from"./chunk-NA4J3L4H.js";import"./chunk-4SM2VG5F.js";import{A as ce,B as pe,C as me,D as _e,E as ue,F as de,G as Ee,H as Ce,Ha as D,I as fe,Ia as qe,J as he,Ja as We,K as Se,Ka as Ze,La as Xe,M as Re,O as Ae,Q as Te,R as De,aa as Ie,ba as be,ca as ge,da as ye,ea as Oe,fa as we,ga as Le,ha as ve,ia as xe,ja as Fe,ka as Pe,la as Ve,m as $,ma as Ne,na as Me,oa as He,p as ee,pa as ke,q as T,ra as je,s as te,t as ie,ta as Ue,u as oe,v as ne,w as re,wa as Be,x as ae,xa as Ge,y as se,z as le}from"./chunk-KXXKTX2T.js";import{b as X,c as S,d as J}from"./chunk-737PEWWY.js";import{A as L,B as v,G as V,q as P}from"./chunk-54NO2V2Q.js";import{e as q,i as W,t as Z,v as Q,w as z}from"./chunk-KODN66SN.js";import{$ as p,Aa as s,Ab as F,B as j,Bb as g,Cb as y,Db as O,Fa as h,Fb as G,K as b,Ka as U,Qa as A,Qb as w,Xa as l,a as R,aa as m,b as x,db as r,eb as a,i as k,jb as C,nb as f,ob as c,xb as _,yb as B}from"./chunk-P6AE7GFT.js";var N="Piano di supporto",M=[Be,Ge,Ie,be,ye,Me,He,Ve,Ne,Ue,ge,Oe,we,Le,ve,xe,Fe,Pe,ke,je],H={validators:[],controls:[Te,De,te,ie,oe,ne,re,ae,se,le,ce,pe,me,_e,ue,de,Ee,Ce,fe,he,Se,Re,Ae]};var Ke=()=>["nuovo"];function Ye(o,E){if(o&1&&(r(0,"h1",13),_(1),a()),o&2){let e=c();s(),B(e.table.label)}}function $e(o,E){if(o&1){let e=C();r(0,"app-form",14),f("dispacther",function(t){p(e);let n=c();return m(n.onFormEvent(t))}),a()}if(o&2){let e=c();l("form",e.searchForm)("options",e.optionsFrom)}}function et(o,E){if(o&1&&(r(0,"div",15)(1,"p-message",16),_(2),a()()),o&2){let e=c();s(2),F("\xE8 stato selezionato ",e.selectedClients.length," ",e.clientType,"")}}function tt(o,E){if(o&1){let e=C();r(0,"div",17)(1,"div",18)(2,"a",19)(3,"button",20),_(4,"Crea Nuovo PDS"),a()()(),r(5,"div",21)(6,"button",22),f("click",function(){p(e);let t=c();return m(t.showDialogEditValidityDate=!0)}),_(7," Modifica Fine Validit\xE0 "),a(),r(8,"button",22),f("click",function(){p(e);let t=c();return m(t.showDialogRemoveDiscounts=!0)}),_(9," Eliminazione PDS "),a()()()}if(o&2){let e=c();s(2),l("routerLink",G(3,Ke)),s(4),l("disabled",!e.selectedRows.length),s(2),l("disabled",!e.selectedRows.length)}}function it(o,E){if(o&1){let e=C();r(0,"app-table",23),O("selectedRowsChange",function(t){p(e);let n=c();return y(n.selectedRows,t)||(n.selectedRows=t),m(t)}),a()}if(o&2){let e=c();l("numberOfDisplayedColumns",10)("headers",e.table.headers)("data",e.filterdTableData),g("selectedRows",e.selectedRows)}}function ot(o,E){if(o&1){let e=C();r(0,"edit-validity-date-modal",24),f("cancel",function(){p(e);let t=c();return m(t.showDialogEditValidityDate=!1)})("select",function(t){p(e);let n=c();return m(n.onSelectDiscountValidity(t))}),a()}}function nt(o,E){o&1&&(r(0,"div",25)(1,"h2",26),_(2,"Elimina Sconto"),a()())}function rt(o,E){if(o&1){let e=C();r(0,"div",27)(1,"button",28),f("click",function(){p(e);let t=c();return m(t.showDialogRemoveDiscounts=!1)}),_(2," Annulla "),a(),r(3,"button",29),f("click",function(){p(e);let t=c();return m(t.onRemoveDiscounts())}),_(4," Conferma "),a()()}}function at(o,E){o&1&&(r(0,"h1",13),_(1,"Cerca Cliente"),a())}function st(o,E){if(o&1){let e=C();r(0,"search-client",30),f("select",function(t){p(e);let n=c();return m(n.onSelectClients(t))}),a()}if(o&2){let e=c();l("type",e.clientType)}}var Pt=(()=>{class o{scontiService;infoCarService;queryStore;carStore;route;router;searchForm;optionsFrom;selectedRows;table;filterdTableData;showDialogEditValidityDate;showDialogRemoveDiscounts;showDialogSearchClient;clientType;selectedClients;destroySubject=new k;constructor(e,i,t,n,d,u){this.scontiService=e,this.infoCarService=i,this.queryStore=t,this.carStore=n,this.route=d,this.router=u,this.router.navigate([],{queryParams:{}}),this.table={data:[],label:N,headers:M},this.filterdTableData=[]}ngOnInit(){this.selectedRows=new Array,this.showDialogRemoveDiscounts=!1,this.showDialogEditValidityDate=!1,this.showDialogSearchClient=!1,this.subscribeQueryParams(),this.subscribeAutocomplition()}onFormEvent({type:e,payload:i}){switch(e){case D.FormSubmit:this.onFilterSubmit(i);break;case D.FormLookup:i?.name==v&&(this.clientType=T.Cliente),i?.name==L&&(this.clientType=T.CapoGruppo),this.showDialogSearchClient=!0;break;case D.FormChange:this.onFilterChange(i);break;case D.FormAutocomplete:this.optionsFrom[i.name]||this.fetchAutoCompletion(i.name)}}onFilterChange(e){this.searchForm.controls.forEach(i=>i.default=e[i.name]),!e[v]&&!e[L]&&(this.selectedClients=null),this.searchForm=R({},this.searchForm)}onRemoveDiscounts(){this.showDialogRemoveDiscounts=!1,this.filterdTableData=this.filterdTableData.filter(e=>!this.selectedRows.find(i=>i.id==e.id)),this.selectedRows.splice(0)}onSelectDiscountValidity(e){let i=ze.parseDateToString(e,"yyyy-MM-dd");this.showDialogEditValidityDate=!1,this.filterdTableData=this.filterdTableData.map(t=>this.selectedRows.find(n=>n.id==t.id)?x(R({},t),{[P]:i}):t),this.selectedRows=this.selectedRows.map(t=>x(R({},t),{[P]:i}))}onSelectClients(e){let i="Selezione Multipla";if(e.length==1){let n=this.clientType==T.Cliente?V:V;i=e[0][n]}this.showDialogSearchClient=!1,this.selectedClients=e;let t=this.clientType==T.Cliente?v:L;this.onFilterChange({[t]:i})}onFilterSubmit(e){let i={},t=this.searchForm.controls.map(n=>n.name);t.filter(n=>e[n]!=null).forEach(n=>i[n]=e[n]),this.router.navigate([],{queryParams:i}),this.queryStore.setParamsPDS(i),this.fetchScontiDS(()=>{let n=u=>{for(let I of t)if(e[I]!=null&&e[I]!=""&&e[I]!=u[I])return!1;return!0},d=this.table.data.filter(n);this.filterdTableData=d})}fetchScontiDS(e){let i={"X-UNIPOL-REQUESTID":crypto.randomUUID()};this.scontiService.getScontipianoDiSupporto(i).pipe(b(this.destroySubject)).subscribe({next:t=>{this.table={data:t,label:N,headers:M},this.filterdTableData=[...t],S.print("getScontiCostruttore","result",t),e&&e()},error:t=>{S.print("getScontiCostruttore","error",t)},complete:()=>{S.print("getScontiCostruttore","complete")}})}fetchAutoCompletion(e){this.infoCarService.autoComplete(e).pipe(b(this.destroySubject)).subscribe({next:i=>{this.carStore.setOptions(e,i),S.print("fetchAutoCompletion","result",e)},error:i=>{S.print("fetchAutoCompletion","error",e)},complete:()=>{S.print("fetchAutoCompletion","complete",e)}})}subscribeAutocomplition(){let e=H.controls.filter(i=>i.autocomplete).map(i=>i.name);this.carStore.autocomplitionOptions(e).pipe(b(this.destroySubject)).subscribe(i=>{this.optionsFrom=i})}subscribeQueryParams(){this.queryStore.subscribeParamsPDS().pipe(j(1)).subscribe(e=>{let i=R(R({},e),this.route.snapshot.queryParams);this.searchForm=qe(H,i);let t={};this.searchForm.controls.forEach(d=>{t[d.name]=d.default}),Object.keys(t).some(d=>!!t[d])&&this.onFilterSubmit(t)})}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}static \u0275fac=function(i){return new(i||o)(h(X),h(J),h(Y),h(Xe),h(Z),h(Q))};static \u0275cmp=U({type:o,selectors:[["app-sconti-piano-supporto"]],decls:21,vars:13,consts:[["header",""],["footer",""],[1,"sconto-pds","page"],["class","text-4xl",4,"ngIf"],["clearButton","Rimuovi filtri","buttonLabel","Cerca",3,"form","options","dispacther",4,"ngIf"],["class","pb-4",4,"ngIf"],["class","action flex",4,"ngIf"],[3,"numberOfDisplayedColumns","headers","data","selectedRows","selectedRowsChange",4,"ngIf"],[3,"cancel","select",4,"ngIf"],[3,"visibleChange","modal","visible"],[1,"flex","flex-col","gap-4","mb-4"],[1,"mb-3"],[3,"type","select",4,"ngIf"],[1,"text-4xl"],["clearButton","Rimuovi filtri","buttonLabel","Cerca",3,"dispacther","form","options"],[1,"pb-4"],["icon","pi pi-check-circle","severity","info","variant","outlined"],[1,"action","flex"],[1,"flex","gap-2","justify-start"],["routerLinkActive","router-link-active",1,"ur-a",3,"routerLink"],[1,"ur-button","accent"],[1,"flex","gap-2","justify-end"],["type","button",1,"ur-button","secondary",3,"click","disabled"],[3,"selectedRowsChange","numberOfDisplayedColumns","headers","data","selectedRows"],[3,"cancel","select"],[1,"inline-flex","items-center","justify-center","gap-2"],[1,"text-2xl"],[1,"flex","justify-between","w-full"],["type","button",1,"ur-button","secondary",3,"click"],["type","button",1,"ur-button","accent",3,"click"],[3,"select","type"]],template:function(i,t){if(i&1){let n=C();r(0,"div",2),A(1,Ye,2,1,"h1",3)(2,$e,1,2,"app-form",4)(3,et,3,2,"div",5)(4,tt,10,4,"div",6)(5,it,1,4,"app-table",7),a(),A(6,ot,1,0,"edit-validity-date-modal",8),r(7,"p-dialog",9),O("visibleChange",function(u){return p(n),y(t.showDialogRemoveDiscounts,u)||(t.showDialogRemoveDiscounts=u),m(u)}),A(8,nt,3,0,"ng-template",null,0,w),r(10,"div",10)(11,"p",11),_(12,"Verr\xE0 Eliminato lo sconto da CPQ !"),a(),r(13,"p",11),_(14),a()(),A(15,rt,5,0,"ng-template",null,1,w),a(),r(17,"p-dialog",9),O("visibleChange",function(u){return p(n),y(t.showDialogSearchClient,u)||(t.showDialogSearchClient=u),m(u)}),A(18,at,2,0,"ng-template",null,0,w)(20,st,1,1,"search-client",12),a()}i&2&&(s(),l("ngIf",t.table),s(),l("ngIf",t.searchForm),s(),l("ngIf",t.selectedClients),s(),l("ngIf",t.table),s(),l("ngIf",t.table),s(),l("ngIf",t.showDialogEditValidityDate),s(),l("modal",!0),g("visible",t.showDialogRemoveDiscounts),s(7),F(" Hai selezionato ",t.selectedRows.length," ",t.selectedRows.length==1?"sconto":"sconti"," "),s(3),l("modal",!0),g("visible",t.showDialogSearchClient),s(3),l("ngIf",t.showDialogSearchClient))},dependencies:[W,q,We,Ze,$,z,ee,Qe,Je,K],styles:[".action[_ngcontent-%COMP%]{justify-content:space-between;padding-bottom:2rem}.form-group[_ngcontent-%COMP%]{flex:1 1 0}"]})}return o})();export{Pt as ScontiPianoSupportoComponent};
