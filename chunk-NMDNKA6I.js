import{a as Qt,b as Wt}from"./chunk-LG3XSIQP.js";import{A as at,B as lt,C as ct,D as mt,E as _t,G as pt,H as ut,Ha as I,I as dt,Ia as jt,J as ft,Ja as Zt,K as Et,Ka as Bt,L as Ct,M as ht,N as Rt,O as At,aa as Tt,ba as bt,ca as Dt,da as It,ea as St,fa as Ot,ga as gt,ha as wt,ia as yt,ja as xt,ka as Ft,la as vt,m as K,ma as Lt,na as Vt,oa as Nt,p as Y,pa as Pt,qa as Mt,ra as Ht,s as $,sa as Ut,t as tt,ta as kt,u as et,v as ot,w as it,x as rt,y as nt,z as st}from"./chunk-5M4TV7DC.js";import{b as z,c as C,d as X}from"./chunk-7HSNJ7HC.js";import{O as J,t as x,x as F,y as v,z as L}from"./chunk-NWQVG56C.js";import{e as B,i as Q,u as W,w as q,x as G}from"./chunk-5XZD4T2H.js";import{$ as p,Aa as m,Ab as j,B as H,Bb as O,Cb as g,Db as w,Fa as A,Fb as Z,K as D,Ka as U,Qa as b,Qb as y,Xa as _,a as R,aa as u,b as S,db as a,eb as s,i as M,jb as f,nb as E,ob as l,xb as d,yb as k}from"./chunk-QIVHEG4A.js";var V="Sconto Costruttore",N=[Tt,bt,It,Vt,Nt,Mt,vt,Lt,kt,Dt,St,Ot,gt,wt,yt,xt,Ft,Pt,Ht,Ut],P={validators:[],controls:[$,tt,et,ot,it,rt,nt,st,at,lt,ct,mt,_t,pt,ut,dt,ft,Et,Ct,At]};var qt=()=>["nuovo"];function Gt(r,T){if(r&1){let e=f();a(0,"app-form",11),E("dispacther",function(t){p(e);let i=l();return u(i.onFormEvent(t))}),s()}if(r&2){let e=l();_("form",e.searchForm)("options",e.optionsFrom)}}function zt(r,T){if(r&1){let e=f();a(0,"div",12)(1,"div",13)(2,"a",14)(3,"button",15),d(4," Crea Nuovo Sconto "),s()()(),a(5,"div",16)(6,"button",17),E("click",function(){p(e);let t=l();return u(t.showDialogEditValidityDate=!0)}),d(7," Modifica Fine Validit\xE0 "),s(),a(8,"button",17),E("click",function(){p(e);let t=l();return u(t.showDialogRemoveDiscounts=!0)}),d(9," Eliminazione Sconto "),s()()()}if(r&2){let e=l();m(2),_("routerLink",Z(3,qt)),m(4),_("disabled",!e.selectedRows.length),m(2),_("disabled",!e.selectedRows.length)}}function Xt(r,T){if(r&1){let e=f();a(0,"app-table",18),w("selectedRowsChange",function(t){p(e);let i=l();return g(i.selectedRows,t)||(i.selectedRows=t),u(t)}),s()}if(r&2){let e=l();_("numberOfDisplayedColumns",9)("headers",e.table.headers)("data",e.filterdTableData),O("selectedRows",e.selectedRows)}}function Jt(r,T){if(r&1){let e=f();a(0,"edit-validity-date-modal",19),E("cancel",function(){p(e);let t=l();return u(t.showDialogEditValidityDate=!1)})("select",function(t){p(e);let i=l();return u(i.onSelectDiscountValidity(t))}),s()}}function Kt(r,T){r&1&&(a(0,"div",20)(1,"h2",21),d(2,"Elimina Sconto"),s()())}function Yt(r,T){if(r&1){let e=f();a(0,"div",22)(1,"button",23),E("click",function(){p(e);let t=l();return u(t.showDialogRemoveDiscounts=!1)}),d(2," Annulla "),s(),a(3,"button",24),E("click",function(){p(e);let t=l();return u(t.onRemoveDiscounts())}),d(4," Conferma "),s()()}}var be=(()=>{class r{scontiService;infoCarService;store;route;router;searchForm;optionsFrom;selectedRows;table;filterdTableData;showDialogEditValidityDate;showDialogRemoveDiscounts;destroySubject=new M;constructor(e,o,t,i,c){this.scontiService=e,this.infoCarService=o,this.store=t,this.route=i,this.router=c,this.router.navigate([],{queryParams:{}}),this.table={data:[],label:V,headers:N},this.filterdTableData=[]}ngOnInit(){this.selectedRows=new Array,this.showDialogEditValidityDate=!1,this.showDialogRemoveDiscounts=!1,this.subscribeQueryParams(),this.subscribeAutocomplition()}onFormEvent(e){let{type:o,payload:t}=e;switch(o){case I.FormSubmit:this.onFilterSubmit(t);break;case I.FormChange:this.onFilterChange(t);break;case I.FormAutocomplete:this.optionsFrom[t.name]||this.fetchAutoCompletion(t.name)}}onFilterSubmit(e){let o={},t=this.searchForm.controls.map(i=>i.name);t.filter(i=>e[i]!=null).forEach(i=>o[i]=e[i]),this.router.navigate([],{queryParams:o}),this.store.setParamsCostruttore(o),this.fetchScontiCostruttore(()=>{let i=n=>{for(let h of t)if(e[h]!=null&&e[h]!=""&&e[h]!=n[h])return!1;return!0},c=this.table.data.filter(i);this.filterdTableData=c})}onFilterChange(e){let o=()=>{this.searchForm.controls.forEach(n=>n.default=e[n.name]),this.searchForm=R({},this.searchForm)},t=e[F],i=this.searchForm.controls.find(n=>n.name==v),c=this.searchForm.controls.find(n=>n.name==L);if(t!="Promo"&&(i||c)&&(this.searchForm.controls=this.searchForm.controls.filter(n=>![v,L].includes(n.name)),o()),t=="Promo"&&!i){let n=this.searchForm.controls.findIndex(h=>h.name==F);n!=-1&&(this.searchForm.controls=[...this.searchForm.controls.slice(0,n+1),ht,Rt,...this.searchForm.controls.slice(n+1)]),o()}}onRemoveDiscounts(){this.showDialogRemoveDiscounts=!1,this.filterdTableData=this.filterdTableData.filter(e=>!this.selectedRows.find(o=>o.id==e.id)),this.selectedRows.splice(0)}onSelectDiscountValidity(e){let o=Wt.parseDateToString(e,"yyyy-MM-dd");this.showDialogEditValidityDate=!1,this.filterdTableData=this.filterdTableData.map(t=>this.selectedRows.find(i=>i.id==t.id)?S(R({},t),{[x]:o}):t),this.selectedRows=this.selectedRows.map(t=>S(R({},t),{[x]:o}))}fetchAutoCompletion(e){this.infoCarService.autoComplete(e).pipe(D(this.destroySubject)).subscribe({next:o=>{this.store.setCarOptions(e,o),C.print("fetchAutoCompletion","result",e)},error:o=>{C.print("fetchAutoCompletion","error",e)},complete:()=>{C.print("fetchAutoCompletion","complete",e)}})}fetchScontiCostruttore(e){let o={"X-UNIPOL-REQUESTID":crypto.randomUUID()};this.scontiService.getScontiCostruttore(o).pipe(D(this.destroySubject)).subscribe({next:t=>{this.table={data:t,label:V,headers:N},this.filterdTableData=[...this.table.data],C.print("getScontiCostruttore","result",t),e&&e()},error:t=>{C.print("getScontiCostruttore","error",t)},complete:()=>{C.print("getScontiCostruttore","complete")}})}subscribeAutocomplition(){let e=P.controls.filter(o=>o.autocomplete).map(o=>o.name);this.store.subscribeCarAutoComplition(e).pipe(D(this.destroySubject)).subscribe(o=>{this.optionsFrom=o})}subscribeQueryParams(){this.store.subscribeParamsCostruttore().pipe(H(1)).subscribe(e=>{let o=R(R({},e),this.route.snapshot.queryParams);this.searchForm=jt(P,o);let t={};this.searchForm.controls.forEach(c=>{t[c.name]=c.default}),Object.keys(t).some(c=>!!t[c])&&this.onFilterSubmit(t)})}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}static \u0275fac=function(o){return new(o||r)(A(z),A(X),A(J),A(W),A(q))};static \u0275cmp=U({type:r,selectors:[["app-sconti-costruttore"]],decls:17,vars:9,consts:[["header",""],["footer",""],[1,"sconto-construttore","page"],[1,"text-4xl"],["clearButton","Rimuovi filtri","buttonLabel","Cerca",3,"form","options","dispacther",4,"ngIf"],["class","action flex flex-row flex-wrap gap-2",4,"ngIf"],[3,"numberOfDisplayedColumns","headers","data","selectedRows","selectedRowsChange",4,"ngIf"],[3,"cancel","select",4,"ngIf"],[3,"visibleChange","modal","visible"],[1,"flex","flex-col","gap-4","mb-4"],[1,"mb-3"],["clearButton","Rimuovi filtri","buttonLabel","Cerca",3,"dispacther","form","options"],[1,"action","flex","flex-row","flex-wrap","gap-2"],[1,"flex","flex-row","flex-wrap","gap-2","justify-start"],["routerLinkActive","router-link-active",1,"ur-a",3,"routerLink"],[1,"ur-button","accent","font-semibold"],[1,"flex","flex-row","flex-wrap","gap-2","justify-end"],["type","button",1,"ur-button","secondary",3,"click","disabled"],[3,"selectedRowsChange","numberOfDisplayedColumns","headers","data","selectedRows"],[3,"cancel","select"],[1,"inline-flex","items-center","justify-center","gap-2"],[1,"text-2xl"],[1,"flex","justify-between","w-full"],["type","button",1,"ur-button","secondary",3,"click"],["type","button",1,"ur-button","accent",3,"click"]],template:function(o,t){if(o&1){let i=f();a(0,"div",2)(1,"h1",3),d(2),s(),b(3,Gt,1,2,"app-form",4)(4,zt,10,4,"div",5)(5,Xt,1,4,"app-table",6),s(),b(6,Jt,1,0,"edit-validity-date-modal",7),a(7,"p-dialog",8),w("visibleChange",function(n){return p(i),g(t.showDialogRemoveDiscounts,n)||(t.showDialogRemoveDiscounts=n),u(n)}),b(8,Kt,3,0,"ng-template",null,0,y),a(10,"div",9)(11,"p",10),d(12,"Verr\xE0 Eliminato lo sconto da CPQ !"),s(),a(13,"p",10),d(14),s()(),b(15,Yt,5,0,"ng-template",null,1,y),s()}o&2&&(m(2),k(t.table.label),m(),_("ngIf",t.searchForm),m(),_("ngIf",t.table),m(),_("ngIf",t.table),m(),_("ngIf",t.showDialogEditValidityDate),m(),_("modal",!0),O("visible",t.showDialogRemoveDiscounts),m(7),j(" Hai selezionato ",t.selectedRows.length," ",t.selectedRows.length==1?"sconto":"sconti"," "))},dependencies:[Q,B,Y,Zt,Bt,K,G,Qt],styles:[".action[_ngcontent-%COMP%]{justify-content:space-between;padding-bottom:2rem}.form-group[_ngcontent-%COMP%]{flex:1 1 0}"]})}return r})();export{be as ScontiCostruttoreComponent};
