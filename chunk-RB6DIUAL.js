import{a as mt}from"./chunk-GUEFMBWG.js";import{a as ut}from"./chunk-JDFJ6QK4.js";import"./chunk-5OKU2XER.js";import{A as q,B as X,C as z,Ha as D,Ia as ct,Ja as at,Ka as pt,La as lt,aa as J,ba as K,ca as Y,da as $,ea as tt,fa as et,ga as ot,ha as it,ia as nt,ja as rt,ka as st,p as H,r as M,s as j,t as B,u as U,v as k,w as W,x as Z,y as G,z as Q}from"./chunk-LRR7SAV4.js";import{b as P,c as _,d as V}from"./chunk-F5O3EZP7.js";import"./chunk-XHWAPZXS.js";import{e as L,u as F}from"./chunk-MCQEVFIB.js";import{$ as s,Aa as u,Bb as b,Cb as w,Db as g,Fa as S,Fb as N,K as E,Ka as O,Qa as C,Qb as v,Xa as a,aa as c,db as r,eb as p,fb as x,i as T,jb as f,nb as d,ob as l,xb as h,yb as y}from"./chunk-JC545UEF.js";var _t="Crea Nuovo PDS",dt=[J,K,Y,$,tt,et,ot,it,nt,rt,st],I={validators:[],controls:[j,B,U,k,W,Z,G,Q,q,X,z]};var St=()=>({"overflow-y":"auto","max-width":"100vw"});function ft(n,R){if(n&1){let t=f();r(0,"div",4)(1,"h1",5),h(2),p(),r(3,"app-form",6),d("dispacther",function(o){s(t);let i=l();return c(i.onFormEvent(o))}),p(),r(4,"div",7),x(5,"div",8),r(6,"div",9)(7,"button",10),d("click",function(){s(t);let o=l();return c(o.showDialogNewDiscount=!0)}),h(8," Aggiungi Sconto "),p()()(),r(9,"app-table",11),g("selectedRowsChange",function(o){s(t);let i=l();return w(i.selectedRows,o)||(i.selectedRows=o),c(o)}),p()()}if(n&2){let t=l();u(2),y(t.table.label),u(),a("form",t.searchForm)("options",t.optionsFrom),u(4),a("disabled",!t.selectedRows.length),u(2),a("headers",t.table.headers)("data",t.filterdTableData),b("selectedRows",t.selectedRows)}}function Et(n,R){n&1&&(r(0,"h1",12),h(1,"Aggiungi Sconto"),p())}function Ct(n,R){if(n&1){let t=f();r(0,"search-client",15),d("select",function(o){s(t);let i=l(2);return c(i.onSelectClients(o))}),p()}}function ht(n,R){if(n&1){let t=f();r(0,"add-sconto",13),d("cancel",function(){s(t);let o=l();return c(o.showDialogNewDiscount=o.discountSelected=!1)})("submit",function(o){s(t);let i=l();return c(i.onAddNewDiscount(o))}),p(),C(1,Ct,1,0,"search-client",14)}if(n&2){let t=l();a("added",t.discountSelected)("type",t.disountType),u(),a("ngIf",t.discountSelected)}}var jt=(()=>{class n{scontiService;route;infoCarService;store;optionsFrom;searchForm;table;filterdTableData;showDialogNewDiscount;discountSelected;selectedRows;form;formSubmitted;destroySubject=new T;disountType=M.PDS;constructor(t,e,o,i){this.scontiService=t,this.route=e,this.infoCarService=o,this.store=i}ngOnInit(){this.selectedRows=[],this.showDialogNewDiscount=!1,this.searchForm=ct(I,this.route.snapshot.queryParams);let t={"X-UNIPOL-REQUESTID":crypto.randomUUID()};this.fetchCars(t),this.subscribeAutocomplition()}onFormEvent(t){let{type:e,payload:o}=t;switch(e){case D.FormSubmit:this.onFilterSubmit(o);break;case D.FormAutocomplete:this.optionsFrom[o.name]||this.fetchAutoCompletion(o.name)}}onFilterSubmit(t){if(!t){this.filterdTableData=this.table.data;return}let e=Object.keys(t),o=A=>{for(let m of e)if(t[m]!=null&&t[m]!=""&&t[m]!=A[m])return!1;return!0},i=this.table.data.filter(o);this.filterdTableData=i}onSelectClients(t){this.showDialogNewDiscount=!1}onAddNewDiscount(t){this.discountSelected=!0}fetchCars(t){this.scontiService.getVeicoli(t).pipe(E(this.destroySubject)).subscribe({next:e=>{this.table={data:e,label:_t,headers:dt},this.filterdTableData=[...this.table.data],_.print("getScontiCostruttore","result",e)},error:e=>{_.print("getScontiCostruttore","error",e)},complete:()=>{_.print("getScontiCostruttore","complete")}})}fetchAutoCompletion(t){this.infoCarService.autoComplete(t).pipe(E(this.destroySubject)).subscribe({next:e=>{this.store.setCarOptions(t,e),_.print("fetchAutoCompletion","result",t)},error:e=>{_.print("fetchAutoCompletion","error",t)},complete:()=>{_.print("fetchAutoCompletion","complete",t)}})}subscribeAutocomplition(){let t=I.controls.filter(e=>e.autocomplete).map(e=>e.name);this.store.subscribeCarAutoComplition(t).pipe(E(this.destroySubject)).subscribe(e=>{this.optionsFrom=e})}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}static \u0275fac=function(e){return new(e||n)(S(P),S(F),S(V),S(lt))};static \u0275cmp=O({type:n,selectors:[["app-sconto-piano-supporto-nuovo"]],decls:6,vars:5,consts:[["header",""],["content",""],["class","sconto-construttore page",4,"ngIf"],[3,"visibleChange","onHide","modal","visible","contentStyle"],[1,"sconto-construttore","page"],[1,"text-4xl"],["clearButton","Rimuovi filtri","buttonLabel","Cerca",3,"dispacther","form","options"],[1,"action","flex"],[1,"flex","justify-start"],[1,"flex","justify-end"],["type","button",1,"ur-button","accent",3,"click","disabled"],[3,"selectedRowsChange","headers","data","selectedRows"],[1,"text-2xl"],[3,"cancel","submit","added","type"],[3,"select",4,"ngIf"],[3,"select"]],template:function(e,o){if(e&1){let i=f();C(0,ft,10,7,"div",2),r(1,"p-dialog",3),g("visibleChange",function(m){return s(i),w(o.showDialogNewDiscount,m)||(o.showDialogNewDiscount=m),c(m)}),d("onHide",function(){return s(i),c(o.discountSelected=!1)}),C(2,Et,2,0,"ng-template",null,0,v)(4,ht,2,3,"ng-template",null,1,v),p()}e&2&&(a("ngIf",o.table),u(),a("modal",!0),b("visible",o.showDialogNewDiscount),a("contentStyle",N(4,St)))},dependencies:[L,at,H,pt,mt,ut],styles:[".action[_ngcontent-%COMP%]{justify-content:space-between;padding-bottom:2rem}.form-group[_ngcontent-%COMP%]{flex:1 1 0}"]})}return n})();export{jt as ScontoPianoSupportoNuovoComponent};
