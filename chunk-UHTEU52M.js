import{a as qt,b as Qt}from"./chunk-LZPMS7K5.js";import{a as J}from"./chunk-HNRD2T62.js";import{A as at,B as ct,C as lt,D as mt,E as _t,G as pt,H as ut,Ha as D,I as dt,Ia as jt,J as ft,Ja as Zt,K as Et,Ka as Bt,L as Ct,La as Wt,M as ht,N as Rt,O as At,aa as St,ba as Tt,ca as bt,da as Dt,ea as It,fa as Ot,ga as yt,ha as gt,ia as wt,ja as xt,ka as vt,la as Ft,m as K,ma as Lt,na as Vt,oa as Nt,p as Y,pa as Pt,qa as Mt,ra as Ht,s as $,sa as Ut,t as tt,ta as kt,u as et,v as ot,w as it,x as rt,y as nt,z as st}from"./chunk-KXXKTX2T.js";import{b as z,c as h,d as X}from"./chunk-737PEWWY.js";import{q as x,u as v,v as F,w as L}from"./chunk-54NO2V2Q.js";import{e as B,i as q,t as Q,v as W,w as G}from"./chunk-KODN66SN.js";import{$ as p,Aa as m,Ab as j,B as H,Bb as O,Cb as y,Db as g,Fa as f,Fb as Z,K as b,Ka as U,Qa as T,Qb as w,Xa as _,a as A,aa as u,b as I,db as a,eb as s,i as M,jb as E,nb as C,ob as c,xb as d,yb as k}from"./chunk-P6AE7GFT.js";var V="Sconto Costruttore",N=[St,Tt,Dt,Vt,Nt,Mt,Ft,Lt,kt,bt,It,Ot,yt,gt,wt,xt,vt,Pt,Ht,Ut],P={validators:[],controls:[$,tt,et,ot,it,rt,nt,st,at,ct,lt,mt,_t,pt,ut,dt,ft,Et,Ct,At]};var Gt=()=>["nuovo"];function zt(n,S){if(n&1){let e=E();a(0,"app-form",11),C("dispacther",function(t){p(e);let i=c();return u(i.onFormEvent(t))}),s()}if(n&2){let e=c();_("form",e.searchForm)("options",e.optionsFrom)}}function Xt(n,S){if(n&1){let e=E();a(0,"div",12)(1,"div",13)(2,"a",14)(3,"button",15),d(4," Crea Nuovo Sconto "),s()()(),a(5,"div",16)(6,"button",17),C("click",function(){p(e);let t=c();return u(t.showDialogEditValidityDate=!0)}),d(7," Modifica Fine Validit\xE0 "),s(),a(8,"button",17),C("click",function(){p(e);let t=c();return u(t.showDialogRemoveDiscounts=!0)}),d(9," Eliminazione Sconto "),s()()()}if(n&2){let e=c();m(2),_("routerLink",Z(3,Gt)),m(4),_("disabled",!e.selectedRows.length),m(2),_("disabled",!e.selectedRows.length)}}function Jt(n,S){if(n&1){let e=E();a(0,"app-table",18),g("selectedRowsChange",function(t){p(e);let i=c();return y(i.selectedRows,t)||(i.selectedRows=t),u(t)}),s()}if(n&2){let e=c();_("numberOfDisplayedColumns",9)("headers",e.table.headers)("data",e.filterdTableData),O("selectedRows",e.selectedRows)}}function Kt(n,S){if(n&1){let e=E();a(0,"edit-validity-date-modal",19),C("cancel",function(){p(e);let t=c();return u(t.showDialogEditValidityDate=!1)})("select",function(t){p(e);let i=c();return u(i.onSelectDiscountValidity(t))}),s()}}function Yt(n,S){n&1&&(a(0,"div",20)(1,"h2",21),d(2,"Elimina Sconto"),s()())}function $t(n,S){if(n&1){let e=E();a(0,"div",22)(1,"button",23),C("click",function(){p(e);let t=c();return u(t.showDialogRemoveDiscounts=!1)}),d(2," Annulla "),s(),a(3,"button",24),C("click",function(){p(e);let t=c();return u(t.onRemoveDiscounts())}),d(4," Conferma "),s()()}}var De=(()=>{class n{scontiService;infoCarService;carStore;queryStore;route;router;searchForm;optionsFrom;selectedRows;table;filterdTableData;showDialogEditValidityDate;showDialogRemoveDiscounts;destroySubject=new M;constructor(e,o,t,i,l,r){this.scontiService=e,this.infoCarService=o,this.carStore=t,this.queryStore=i,this.route=l,this.router=r,this.router.navigate([],{queryParams:{}}),this.table={data:[],label:V,headers:N},this.filterdTableData=[]}ngOnInit(){this.selectedRows=new Array,this.showDialogEditValidityDate=!1,this.showDialogRemoveDiscounts=!1,this.subscribeQueryParams(),this.subscribeAutocomplition()}onFormEvent(e){let{type:o,payload:t}=e;switch(o){case D.FormSubmit:this.onFilterSubmit(t);break;case D.FormChange:this.onFilterChange(t);break;case D.FormAutocomplete:this.optionsFrom[t.name]||this.fetchAutoCompletion(t.name)}}onFilterSubmit(e){let o={},t=this.searchForm.controls.map(i=>i.name);t.filter(i=>e[i]!=null).forEach(i=>o[i]=e[i]),this.router.navigate([],{queryParams:o}),this.queryStore.setParamsCostruttore(o),this.fetchScontiCostruttore(()=>{let i=r=>{for(let R of t)if(e[R]!=null&&e[R]!=""&&e[R]!=r[R])return!1;return!0},l=this.table.data.filter(i);this.filterdTableData=l})}onFilterChange(e){let o=()=>{this.searchForm.controls.forEach(r=>r.default=e[r.name]),this.searchForm=A({},this.searchForm)},t=e[v],i=this.searchForm.controls.find(r=>r.name==F),l=this.searchForm.controls.find(r=>r.name==L);if(t!="Promo"&&(i||l)&&(this.searchForm.controls=this.searchForm.controls.filter(r=>![F,L].includes(r.name)),o()),t=="Promo"&&!i){let r=this.searchForm.controls.findIndex(R=>R.name==v);r!=-1&&(this.searchForm.controls=[...this.searchForm.controls.slice(0,r+1),ht,Rt,...this.searchForm.controls.slice(r+1)]),o()}}onRemoveDiscounts(){this.showDialogRemoveDiscounts=!1,this.filterdTableData=this.filterdTableData.filter(e=>!this.selectedRows.find(o=>o.id==e.id)),this.selectedRows.splice(0)}onSelectDiscountValidity(e){let o=Qt.parseDateToString(e,"yyyy-MM-dd");this.showDialogEditValidityDate=!1,this.filterdTableData=this.filterdTableData.map(t=>this.selectedRows.find(i=>i.id==t.id)?I(A({},t),{[x]:o}):t),this.selectedRows=this.selectedRows.map(t=>I(A({},t),{[x]:o}))}fetchAutoCompletion(e){this.infoCarService.autoComplete(e).pipe(b(this.destroySubject)).subscribe({next:o=>{this.carStore.setOptions(e,o),h.print("fetchAutoCompletion","result",e)},error:o=>{h.print("fetchAutoCompletion","error",e)},complete:()=>{h.print("fetchAutoCompletion","complete",e)}})}fetchScontiCostruttore(e){let o={"X-UNIPOL-REQUESTID":crypto.randomUUID()};this.scontiService.getScontiCostruttore(o).pipe(b(this.destroySubject)).subscribe({next:t=>{this.table={data:t,label:V,headers:N},this.filterdTableData=[...this.table.data],h.print("getScontiCostruttore","result",t),e&&e()},error:t=>{h.print("getScontiCostruttore","error",t)},complete:()=>{h.print("getScontiCostruttore","complete")}})}subscribeAutocomplition(){let e=P.controls.filter(o=>o.autocomplete).map(o=>o.name);this.carStore.autocomplitionOptions(e).pipe(b(this.destroySubject)).subscribe(o=>{this.optionsFrom=o})}subscribeQueryParams(){this.queryStore.subscribeParamsCostruttore().pipe(H(1)).subscribe(e=>{let o=A(A({},e),this.route.snapshot.queryParams);this.searchForm=jt(P,o);let t={};this.searchForm.controls.forEach(l=>{t[l.name]=l.default}),Object.keys(t).some(l=>!!t[l])&&this.onFilterSubmit(t)})}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}static \u0275fac=function(o){return new(o||n)(f(z),f(X),f(Wt),f(J),f(Q),f(W))};static \u0275cmp=U({type:n,selectors:[["app-sconti-costruttore"]],decls:17,vars:9,consts:[["header",""],["footer",""],[1,"sconto-construttore","page"],[1,"text-4xl"],["clearButton","Rimuovi filtri","buttonLabel","Cerca",3,"form","options","dispacther",4,"ngIf"],["class","action flex flex-row flex-wrap gap-2",4,"ngIf"],[3,"numberOfDisplayedColumns","headers","data","selectedRows","selectedRowsChange",4,"ngIf"],[3,"cancel","select",4,"ngIf"],[3,"visibleChange","modal","visible"],[1,"flex","flex-col","gap-4","mb-4"],[1,"mb-3"],["clearButton","Rimuovi filtri","buttonLabel","Cerca",3,"dispacther","form","options"],[1,"action","flex","flex-row","flex-wrap","gap-2"],[1,"flex","flex-row","flex-wrap","gap-2","justify-start"],["routerLinkActive","router-link-active",1,"ur-a",3,"routerLink"],[1,"ur-button","accent","font-semibold"],[1,"flex","flex-row","flex-wrap","gap-2","justify-end"],["type","button",1,"ur-button","secondary",3,"click","disabled"],[3,"selectedRowsChange","numberOfDisplayedColumns","headers","data","selectedRows"],[3,"cancel","select"],[1,"inline-flex","items-center","justify-center","gap-2"],[1,"text-2xl"],[1,"flex","justify-between","w-full"],["type","button",1,"ur-button","secondary",3,"click"],["type","button",1,"ur-button","accent",3,"click"]],template:function(o,t){if(o&1){let i=E();a(0,"div",2)(1,"h1",3),d(2),s(),T(3,zt,1,2,"app-form",4)(4,Xt,10,4,"div",5)(5,Jt,1,4,"app-table",6),s(),T(6,Kt,1,0,"edit-validity-date-modal",7),a(7,"p-dialog",8),g("visibleChange",function(r){return p(i),y(t.showDialogRemoveDiscounts,r)||(t.showDialogRemoveDiscounts=r),u(r)}),T(8,Yt,3,0,"ng-template",null,0,w),a(10,"div",9)(11,"p",10),d(12,"Verr\xE0 Eliminato lo sconto da CPQ !"),s(),a(13,"p",10),d(14),s()(),T(15,$t,5,0,"ng-template",null,1,w),s()}o&2&&(m(2),k(t.table.label),m(),_("ngIf",t.searchForm),m(),_("ngIf",t.table),m(),_("ngIf",t.table),m(),_("ngIf",t.showDialogEditValidityDate),m(),_("modal",!0),O("visible",t.showDialogRemoveDiscounts),m(7),j(" Hai selezionato ",t.selectedRows.length," ",t.selectedRows.length==1?"sconto":"sconti"," "))},dependencies:[q,B,Y,Zt,Bt,K,G,qt],styles:[".action[_ngcontent-%COMP%]{justify-content:space-between;padding-bottom:2rem}.form-group[_ngcontent-%COMP%]{flex:1 1 0}"]})}return n})();export{De as ScontiCostruttoreComponent};
