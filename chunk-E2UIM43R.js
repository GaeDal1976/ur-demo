import{a as Ct}from"./chunk-FFBSDTUM.js";import{A as Y,B as $,C as tt,Ha as I,Ia as _t,Ja as ft,Ka as Et,P as et,aa as ot,ba as it,ca as rt,da as nt,ea as st,fa as at,ga as ct,ha as lt,ia as mt,ja as pt,ka as ut,m as B,p as U,r as W,s as Z,t as q,u as Q,ua as dt,v as G,w as X,x as z,y as J,z as K}from"./chunk-5M4TV7DC.js";import{b as H,c as u,d as P}from"./chunk-7HSNJ7HC.js";import{O as k}from"./chunk-NWQVG56C.js";import{e as x,u as V,w as j,x as M}from"./chunk-5XZD4T2H.js";import{$ as c,Aa as m,Bb as v,Cb as w,Db as D,Fa as _,K as h,Ka as y,Qa as A,Qb as F,Xa as p,aa as l,db as r,eb as s,fb as R,i as L,jb as S,nb as b,ob as f,xb as E,yb as N}from"./chunk-QIVHEG4A.js";var O="Crea Nuovo Sconto",g=[ot,it,rt,nt,st,at,ct,lt,mt,pt,ut,dt],T={validators:[],controls:[Z,q,Q,G,X,z,J,K,Y,$,tt,et]};function bt(n,ht){if(n&1){let t=S();r(0,"div",4)(1,"div",5)(2,"h1",6),E(3),s(),r(4,"a",7)(5,"button",8),R(6,"span",9),r(7,"span"),E(8,"Indietro"),s()()()(),r(9,"app-form",10),b("dispacther",function(e){c(t);let i=f();return l(i.onFormEvent(e))}),s(),r(10,"div",11),R(11,"div",12),r(12,"div",13)(13,"button",14),b("click",function(){c(t);let e=f();return l(e.showDialogNewDiscount=!0)}),E(14," Aggiungi Sconto "),s()()(),r(15,"app-table",15),D("selectedRowsChange",function(e){c(t);let i=f();return w(i.selectedRows,e)||(i.selectedRows=e),l(e)}),s()()}if(n&2){let t=f();m(3),N(t.table.label),m(6),p("form",t.searchForm)("options",t.optionsFrom),m(4),p("disabled",!t.selectedRows.length),m(2),p("headers",t.table.headers)("data",t.filterdTableData),v("selectedRows",t.selectedRows)}}function At(n,ht){n&1&&(r(0,"h1",16),E(1,"Aggiungi Sconto"),s())}var Bt=(()=>{class n{scontiService;route;router;infoCarService;store;optionsFrom;searchForm;table;filterdTableData;showDialogNewDiscount;selectedRows;form;formSubmitted;destroySubject=new L;disountType=W.Costruttore;constructor(t,o,e,i,d){this.scontiService=t,this.route=o,this.router=e,this.infoCarService=i,this.store=d,this.table={data:[],label:O,headers:g},this.filterdTableData=[]}ngOnInit(){this.selectedRows=[],this.showDialogNewDiscount=!1,this.searchForm=_t(T,this.route.snapshot.queryParams);let t={};this.searchForm.controls.forEach(e=>{t[e.name]=e.default}),Object.keys(t).some(e=>!!t[e])&&this.onFilterSubmit(t),this.subscribeAutocomplition()}onFormEvent(t){let{type:o,payload:e}=t;switch(o){case I.FormSubmit:this.onFilterSubmit(e);break;case I.FormAutocomplete:this.optionsFrom[e.name]||this.fetchAutoCompletion(e.name)}}onFilterSubmit(t){let o={},e=this.searchForm.controls.map(i=>i.name);e.filter(i=>t[i]!=null).forEach(i=>o[i]=t[i]),this.router.navigate([],{queryParams:o}),this.fetchCars(()=>{let i=a=>{for(let C of e)if(t[C]!=null&&t[C]!=""&&t[C]!=a[C])return!1;return!0},d=this.table.data.filter(i);this.filterdTableData=d})}onAddNewDiscount(t){this.showDialogNewDiscount=!1}fetchCars(t){let o={"X-UNIPOL-REQUESTID":crypto.randomUUID()};this.scontiService.getVeicoli(o).pipe(h(this.destroySubject)).subscribe({next:e=>{this.table={data:e,label:O,headers:g},this.filterdTableData=[...this.table.data],u.print("getScontiCostruttore","result",e),t&&t()},error:e=>{u.print("getScontiCostruttore","error",e)},complete:()=>{u.print("getScontiCostruttore","complete")}})}fetchAutoCompletion(t){this.infoCarService.autoComplete(t).pipe(h(this.destroySubject)).subscribe({next:o=>{this.store.setCarOptions(t,o),u.print("fetchAutoCompletion","result",t)},error:o=>{u.print("fetchAutoCompletion","error",t)},complete:()=>{u.print("fetchAutoCompletion","complete",t)}})}subscribeAutocomplition(){let t=T.controls.filter(o=>o.autocomplete).map(o=>o.name);this.store.subscribeCarAutoComplition(t).pipe(h(this.destroySubject)).subscribe(o=>{this.optionsFrom=o})}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}static \u0275fac=function(o){return new(o||n)(_(H),_(V),_(j),_(P),_(k))};static \u0275cmp=y({type:n,selectors:[["app-sconto-nuovo"]],decls:5,vars:4,consts:[["header",""],["class","sconto-construttore-nuovo page",4,"ngIf"],[3,"visibleChange","modal","visible"],[3,"cancel","submit","type"],[1,"sconto-construttore-nuovo","page"],[1,"flex","flex-row","justify-between","items-center"],[1,"text-4xl"],["routerLink","/sconti/costruttore","routerLinkActive","router-link-active","routerLinkActive","router-link-active"],[1,"ur-button","flex","justify-between","items-center","gap-2"],[1,"pi","pi-arrow-left"],["clearButton","Rimuovi filtri","buttonLabel","Cerca",3,"dispacther","form","options"],[1,"action","flex"],[1,"flex","justify-start"],[1,"flex","justify-end"],["type","button",1,"ur-button","accent",3,"click","disabled"],[3,"selectedRowsChange","headers","data","selectedRows"],[1,"text-2xl"]],template:function(o,e){if(o&1){let i=S();A(0,bt,16,7,"div",1),r(1,"p-dialog",2),D("visibleChange",function(a){return c(i),w(e.showDialogNewDiscount,a)||(e.showDialogNewDiscount=a),l(a)}),A(2,At,2,0,"ng-template",null,0,F),r(4,"add-sconto",3),b("cancel",function(){return c(i),l(e.showDialogNewDiscount=!1)})("submit",function(a){return c(i),l(e.onAddNewDiscount(a))}),s()()}o&2&&(p("ngIf",e.table),m(),p("modal",!0),v("visible",e.showDialogNewDiscount),m(3),p("type",e.disountType))},dependencies:[x,M,U,ft,B,Ct,Et],styles:[".action[_ngcontent-%COMP%]{justify-content:space-between;padding-bottom:2rem}.form-group[_ngcontent-%COMP%]{flex:1 1 0}"]})}return n})();export{Bt as ScontoCostruttoreNuovoComponent};
