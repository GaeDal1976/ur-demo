import{a as Pt,b as Ut}from"./chunk-7QMZ3LNE.js";import{A as et,B as ot,C as it,D as nt,E as rt,G as st,H as at,Ha as D,I as lt,Ia as Vt,J as ct,Ja as Mt,K as mt,Ka as Ht,L as _t,La as kt,M as pt,N as dt,O as ut,aa as Et,ba as Ct,ca as ft,da as Rt,ea as ht,fa as At,ga as Tt,ha as Dt,ia as Ot,ja as St,ka as It,la as bt,m as G,ma as wt,na as gt,oa as yt,p as z,pa as Lt,qa as vt,ra as Ft,s as Q,sa as xt,t as q,ta as Nt,u as X,v as J,w as K,x as Y,y as $,z as tt}from"./chunk-LRR7SAV4.js";import{b as B,c as E,d as W}from"./chunk-F5O3EZP7.js";import{t as y,x as L,y as v,z as F}from"./chunk-XHWAPZXS.js";import{e as U,i as k,u as j,w as Z}from"./chunk-MCQEVFIB.js";import{$ as l,Aa as m,Ab as H,Bb as I,Cb as b,Db as w,Fa as C,Fb as P,K as A,Ka as V,Qa as T,Qb as g,Xa as d,a as h,aa as c,b as S,db as r,eb as s,i as N,jb as f,nb as u,ob as _,xb as p,yb as M}from"./chunk-JC545UEF.js";var jt="Sconto Costruttore",Zt=[Et,Ct,Rt,gt,yt,vt,Nt,ft,ht,At,Tt,Dt,Ot,St,It,bt,wt,Lt,Ft,xt],x={validators:[],controls:[Q,q,X,J,K,Y,$,tt,et,ot,it,nt,rt,st,at,lt,ct,mt,_t,ut]};var Wt=()=>["nuovo"];function Gt(a,O){if(a&1){let t=f();r(0,"div",7)(1,"h1",8),p(2),s(),r(3,"app-form",9),u("dispacther",function(e){l(t);let n=_();return c(n.onFormEvent(e))}),s(),r(4,"div",10)(5,"div",11)(6,"a",12)(7,"button",13),p(8," Crea Nuovo Sconto "),s()()(),r(9,"div",14)(10,"button",15),u("click",function(){l(t);let e=_();return c(e.showDialogEditValidityDate=!0)}),p(11," Modifica Fine Validit\xE0 "),s(),r(12,"button",15),u("click",function(){l(t);let e=_();return c(e.showDialogRemoveDiscounts=!0)}),p(13," Eliminazione Sconto "),s()()(),r(14,"app-table",16),w("selectedRowsChange",function(e){l(t);let n=_();return b(n.selectedRows,e)||(n.selectedRows=e),c(e)}),s()()}if(a&2){let t=_();m(2),M(t.table.label),m(),d("form",t.searchForm)("options",t.optionsFrom),m(3),d("routerLink",P(10,Wt)),m(4),d("disabled",!t.selectedRows.length),m(2),d("disabled",!t.selectedRows.length),m(2),d("numberOfDisplayedColumns",7)("headers",t.table.headers)("data",t.filterdTableData),I("selectedRows",t.selectedRows)}}function zt(a,O){if(a&1){let t=f();r(0,"edit-validity-date-modal",17),u("cancel",function(){l(t);let e=_();return c(e.showDialogEditValidityDate=!1)})("select",function(e){l(t);let n=_();return c(n.onSelectDiscountValidity(e))}),s()}}function Qt(a,O){a&1&&(r(0,"div",18)(1,"h2",19),p(2,"Elimina Sconto"),s()())}function qt(a,O){if(a&1){let t=f();r(0,"div",20)(1,"button",21),u("click",function(){l(t);let e=_();return c(e.showDialogRemoveDiscounts=!1)}),p(2," Annulla "),s(),r(3,"button",22),u("click",function(){l(t);let e=_();return c(e.onRemoveDiscounts())}),p(4," Conferma "),s()()}}var Re=(()=>{class a{scontiService;infoCarService;store;route;searchForm;optionsFrom;selectedRows;table;filterdTableData;showDialogEditValidityDate;showDialogRemoveDiscounts;today=new Date;destroySubject=new N;constructor(t,o,e,n){this.scontiService=t,this.infoCarService=o,this.store=e,this.route=n}ngOnInit(){this.selectedRows=new Array,this.showDialogEditValidityDate=!1,this.showDialogRemoveDiscounts=!1,this.searchForm=Vt(x,this.route.snapshot.queryParams),this.fetchScontiCostruttore(),this.subscribeAutocomplition()}onFormEvent(t){let{type:o,payload:e}=t;switch(o){case D.FormSubmit:this.onFilterSubmit(e);break;case D.FormChange:this.onFilterChange(e);break;case D.FormAutocomplete:this.optionsFrom[e.name]||this.fetchAutoCompletion(e.name)}}onFilterSubmit(t){if(!t){this.filterdTableData=this.table.data;return}let o=Object.keys(t),e=R=>{for(let i of o)if(t[i]!=null&&t[i]!=""&&t[i]!=R[i])return!1;return!0},n=this.table.data.filter(e);this.filterdTableData=n}onFilterChange(t){let o=()=>{this.searchForm.controls.forEach(i=>i.default=t[i.name]),this.searchForm=h({},this.searchForm)},e=t[L],n=this.searchForm.controls.find(i=>i.name==v),R=this.searchForm.controls.find(i=>i.name==F);if(e!="Promo"&&(n||R)&&(this.searchForm.controls=this.searchForm.controls.filter(i=>![v,F].includes(i.name)),o()),e=="Promo"&&!n){let i=this.searchForm.controls.findIndex(Bt=>Bt.name==L);i!=-1&&(this.searchForm.controls=[...this.searchForm.controls.slice(0,i+1),pt,dt,...this.searchForm.controls.slice(i+1)]),o()}}onRemoveDiscounts(){this.showDialogRemoveDiscounts=!1,this.filterdTableData=this.filterdTableData.filter(t=>!this.selectedRows.find(o=>o.id==t.id)),this.selectedRows.splice(0)}onSelectDiscountValidity(t){let o=Ut.parseDateToString(t,"yyyy-MM-dd");this.showDialogEditValidityDate=!1,this.filterdTableData=this.filterdTableData.map(e=>this.selectedRows.find(n=>n.id==e.id)?S(h({},e),{[y]:o}):e),this.selectedRows=this.selectedRows.map(e=>S(h({},e),{[y]:o}))}fetchAutoCompletion(t){this.infoCarService.autoComplete(t).pipe(A(this.destroySubject)).subscribe({next:o=>{this.store.setCarOptions(t,o),E.print("fetchAutoCompletion","result",t)},error:o=>{E.print("fetchAutoCompletion","error",t)},complete:()=>{E.print("fetchAutoCompletion","complete",t)}})}fetchScontiCostruttore(){let t={"X-UNIPOL-REQUESTID":crypto.randomUUID()};this.scontiService.getScontiCostruttore(t).pipe(A(this.destroySubject)).subscribe({next:o=>{this.table={data:o,label:jt,headers:Zt},this.filterdTableData=[...this.table.data],E.print("getScontiCostruttore","result",o)},error:o=>{E.print("getScontiCostruttore","error",o)},complete:()=>{E.print("getScontiCostruttore","complete")}})}subscribeAutocomplition(){let t=x.controls.filter(o=>o.autocomplete).map(o=>o.name);this.store.subscribeCarAutoComplition(t).pipe(A(this.destroySubject)).subscribe(o=>{this.optionsFrom=o})}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}static \u0275fac=function(o){return new(o||a)(C(B),C(W),C(kt),C(j))};static \u0275cmp=V({type:a,selectors:[["app-sconti-costruttore"]],decls:12,vars:6,consts:[["header",""],["footer",""],["class","sconto-construttore page",4,"ngIf"],[3,"cancel","select",4,"ngIf"],[3,"visibleChange","modal","visible"],[1,"flex","flex-col","gap-4","mb-4"],[1,"mb-3"],[1,"sconto-construttore","page"],[1,"text-4xl"],["clearButton","Rimuovi filtri","buttonLabel","Cerca",3,"dispacther","form","options"],[1,"action","flex","flex-row","flex-wrap","gap-2"],[1,"flex","flex-row","flex-wrap","gap-2","justify-start"],["routerLinkActive","router-link-active",1,"ur-a",3,"routerLink"],[1,"ur-button","accent","font-semibold"],[1,"flex","flex-row","flex-wrap","gap-2","justify-end"],["type","button",1,"ur-button","secondary",3,"click","disabled"],[3,"selectedRowsChange","numberOfDisplayedColumns","headers","data","selectedRows"],[3,"cancel","select"],[1,"inline-flex","items-center","justify-center","gap-2"],[1,"text-2xl"],[1,"flex","justify-between","w-full"],["type","button",1,"ur-button","secondary",3,"click"],["type","button",1,"ur-button","accent",3,"click"]],template:function(o,e){if(o&1){let n=f();T(0,Gt,15,11,"div",2)(1,zt,1,0,"edit-validity-date-modal",3),r(2,"p-dialog",4),w("visibleChange",function(i){return l(n),b(e.showDialogRemoveDiscounts,i)||(e.showDialogRemoveDiscounts=i),c(i)}),T(3,Qt,3,0,"ng-template",null,0,g),r(5,"div",5)(6,"p",6),p(7,"Verr\xE0 Eliminato lo sconto da CPQ !"),s(),r(8,"p",6),p(9),s()(),T(10,qt,5,0,"ng-template",null,1,g),s()}o&2&&(d("ngIf",e.table),m(),d("ngIf",e.showDialogEditValidityDate),m(),d("modal",!0),I("visible",e.showDialogRemoveDiscounts),m(7),H(" Hai selezionato ",e.selectedRows.length," ",e.selectedRows.length==1?"sconto":"sconti"," "))},dependencies:[k,U,z,Mt,Ht,G,Z,Pt],styles:[".action[_ngcontent-%COMP%]{justify-content:space-between;padding-bottom:2rem}.form-group[_ngcontent-%COMP%]{flex:1 1 0}"]})}return a})();export{Re as ScontiCostruttoreComponent};
