import{a as St}from"./chunk-FFBSDTUM.js";import{a as Et}from"./chunk-6GMTMCSA.js";import"./chunk-GIGT64UM.js";import{A as $,B as tt,C as et,Ha as x,Ia as _t,Ja as dt,Ka as ft,aa as ot,ba as it,ca as nt,da as rt,ea as st,fa as at,ga as ct,ha as lt,ia as pt,ja as ut,ka as mt,p as W,r as Z,s as q,t as G,u as Q,v as X,w as z,x as J,y as K,z as Y}from"./chunk-5M4TV7DC.js";import{b as k,c as m,d as B}from"./chunk-7HSNJ7HC.js";import{O as U}from"./chunk-NWQVG56C.js";import{e as V,u as H,w as j,x as M}from"./chunk-5XZD4T2H.js";import{$ as a,Aa as u,Bb as v,Cb as g,Db as D,Fa as _,Fb as P,K as R,Ka as O,Qa as A,Qb as I,Xa as l,aa as c,db as r,eb as s,fb as w,i as N,jb as E,nb as d,ob as p,xb as C,yb as F}from"./chunk-QIVHEG4A.js";var y="Crea Nuovo PDS",T=[ot,it,nt,rt,st,at,ct,lt,pt,ut,mt],L={validators:[],controls:[q,G,Q,X,z,J,K,Y,$,tt,et]};var Ct=()=>({"overflow-y":"auto","max-width":"100vw"});function ht(n,b){if(n&1){let t=E();r(0,"div",4)(1,"div",5)(2,"h1",6),C(3),s(),r(4,"a",7)(5,"button",8),w(6,"span",9),r(7,"span"),C(8,"Indietro"),s()()()(),r(9,"app-form",10),d("dispacther",function(e){a(t);let i=p();return c(i.onFormEvent(e))}),s(),r(10,"div",11),w(11,"div",12),r(12,"div",13)(13,"button",14),d("click",function(){a(t);let e=p();return c(e.showDialogNewDiscount=!0)}),C(14," Aggiungi Sconto "),s()()(),r(15,"app-table",15),D("selectedRowsChange",function(e){a(t);let i=p();return g(i.selectedRows,e)||(i.selectedRows=e),c(e)}),s()()}if(n&2){let t=p();u(3),F(t.table.label),u(6),l("form",t.searchForm)("options",t.optionsFrom),u(4),l("disabled",!t.selectedRows.length),u(2),l("headers",t.table.headers)("data",t.filterdTableData),v("selectedRows",t.selectedRows)}}function Rt(n,b){n&1&&(r(0,"h1",16),C(1,"Aggiungi Sconto"),s())}function At(n,b){if(n&1){let t=E();r(0,"search-client",19),d("select",function(e){a(t);let i=p(2);return c(i.onSelectClients(e))}),s()}}function bt(n,b){if(n&1){let t=E();r(0,"add-sconto",17),d("cancel",function(){a(t);let e=p();return c(e.showDialogNewDiscount=e.discountSelected=!1)})("submit",function(e){a(t);let i=p();return c(i.onAddNewDiscount(e))}),s(),A(1,At,1,0,"search-client",18)}if(n&2){let t=p();l("added",t.discountSelected)("type",t.disountType),u(),l("ngIf",t.discountSelected)}}var Wt=(()=>{class n{scontiService;route;router;infoCarService;store;optionsFrom;searchForm;table;filterdTableData;selectedRows;showDialogNewDiscount;discountSelected;form;formSubmitted;destroySubject=new N;disountType=Z.PDS;constructor(t,o,e,i,f){this.scontiService=t,this.route=o,this.router=e,this.infoCarService=i,this.store=f,this.table={data:[],label:y,headers:T},this.filterdTableData=[]}ngOnInit(){this.selectedRows=[],this.showDialogNewDiscount=!1,this.searchForm=_t(L,this.route.snapshot.queryParams),this.subscribeAutocomplition()}onFormEvent(t){let{type:o,payload:e}=t;switch(o){case x.FormSubmit:this.onFilterSubmit(e);break;case x.FormAutocomplete:this.optionsFrom[e.name]||this.fetchAutoCompletion(e.name)}}onFilterSubmit(t){let o={},e=this.searchForm.controls.map(i=>i.name);e.filter(i=>t[i]!=null).forEach(i=>o[i]=t[i]),this.router.navigate([],{queryParams:o}),this.fetchCars(()=>{let i=S=>{for(let h of e)if(t[h]!=null&&t[h]!=""&&t[h]!=S[h])return!1;return!0},f=this.table.data.filter(i);this.filterdTableData=f})}onSelectClients(t){this.showDialogNewDiscount=!1}onAddNewDiscount(t){this.discountSelected=!0}fetchCars(t){let o={"X-UNIPOL-REQUESTID":crypto.randomUUID()};this.scontiService.getVeicoli(o).pipe(R(this.destroySubject)).subscribe({next:e=>{this.table={data:e,label:y,headers:T},this.filterdTableData=[...this.table.data],m.print("getScontiCostruttore","result",e),t&&t()},error:e=>{m.print("getScontiCostruttore","error",e)},complete:()=>{m.print("getScontiCostruttore","complete")}})}fetchAutoCompletion(t){this.infoCarService.autoComplete(t).pipe(R(this.destroySubject)).subscribe({next:o=>{this.store.setCarOptions(t,o),m.print("fetchAutoCompletion","result",t)},error:o=>{m.print("fetchAutoCompletion","error",t)},complete:()=>{m.print("fetchAutoCompletion","complete",t)}})}subscribeAutocomplition(){let t=L.controls.filter(o=>o.autocomplete).map(o=>o.name);this.store.subscribeCarAutoComplition(t).pipe(R(this.destroySubject)).subscribe(o=>{this.optionsFrom=o})}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}static \u0275fac=function(o){return new(o||n)(_(k),_(H),_(j),_(B),_(U))};static \u0275cmp=O({type:n,selectors:[["app-sconto-piano-supporto-nuovo"]],decls:6,vars:5,consts:[["header",""],["content",""],["class","sconto-pds-nuovo page",4,"ngIf"],[3,"visibleChange","onHide","modal","visible","contentStyle"],[1,"sconto-pds-nuovo","page"],[1,"flex","flex-row","justify-between","items-center"],[1,"text-4xl"],["routerLink","/sconti/piano-supporto","routerLinkActive","router-link-active","routerLinkActive","router-link-active"],[1,"ur-button","flex","justify-between","items-center","gap-2"],[1,"pi","pi-arrow-left"],["clearButton","Rimuovi filtri","buttonLabel","Cerca",3,"dispacther","form","options"],[1,"action","flex"],[1,"flex","justify-start"],[1,"flex","justify-end"],["type","button",1,"ur-button","accent",3,"click","disabled"],[3,"selectedRowsChange","headers","data","selectedRows"],[1,"text-2xl"],[3,"cancel","submit","added","type"],[3,"select",4,"ngIf"],[3,"select"]],template:function(o,e){if(o&1){let i=E();A(0,ht,16,7,"div",2),r(1,"p-dialog",3),D("visibleChange",function(S){return a(i),g(e.showDialogNewDiscount,S)||(e.showDialogNewDiscount=S),c(S)}),d("onHide",function(){return a(i),c(e.discountSelected=!1)}),A(2,Rt,2,0,"ng-template",null,0,I)(4,bt,2,3,"ng-template",null,1,I),s()}o&2&&(l("ngIf",e.table),u(),l("modal",!0),v("visible",e.showDialogNewDiscount),l("contentStyle",P(4,Ct)))},dependencies:[V,M,dt,W,ft,St,Et],styles:[".action[_ngcontent-%COMP%]{justify-content:space-between;padding-bottom:2rem}.form-group[_ngcontent-%COMP%]{flex:1 1 0}"]})}return n})();export{Wt as ScontoPianoSupportoNuovoComponent};
