import{a as St}from"./chunk-7ES4IRLF.js";import{a as Ct}from"./chunk-WMVZP6HY.js";import{a as Et}from"./chunk-NA4J3L4H.js";import"./chunk-4SM2VG5F.js";import{A as Y,B as $,C as tt,Ha as I,Ia as ut,Ja as _t,Ka as dt,La as ft,aa as et,ba as ot,ca as it,da as nt,ea as rt,fa as at,ga as st,ha as lt,ia as ct,ja as pt,ka as mt,p as U,r as W,s as Z,t as q,u as G,v as K,w as Q,x as X,y as z,z as J}from"./chunk-KXXKTX2T.js";import{b as k,c as S,d as B}from"./chunk-737PEWWY.js";import"./chunk-54NO2V2Q.js";import{e as V,t as j,v as H,w as M}from"./chunk-KODN66SN.js";import{$ as l,Aa as _,Bb as x,Cb as A,Db as D,Fa as d,Fb as F,K as b,Ka as P,Qa as w,Qb as g,Xa as m,aa as c,db as r,eb as a,fb as R,i as L,jb as h,nb as f,ob as p,xb as u,yb as y}from"./chunk-P6AE7GFT.js";var T="Crea Nuovo PDS",N=[et,ot,it,nt,rt,at,st,lt,ct,pt,mt],O={validators:[],controls:[Z,q,G,K,Q,X,z,J,Y,$,tt]};var ht=()=>({"overflow-y":"auto","max-width":"100vw"});function gt(n,C){if(n&1){let t=h();r(0,"div",6)(1,"div",7)(2,"h1",8),u(3),a(),r(4,"a",9)(5,"button",10),R(6,"span",11),r(7,"span"),u(8,"Indietro"),a()()()(),r(9,"app-form",12),f("dispacther",function(e){l(t);let i=p();return c(i.onFormEvent(e))}),a(),r(10,"div",13),R(11,"div",14),r(12,"div",15)(13,"button",16),f("click",function(){l(t);let e=p();return c(e.showDialogNewDiscount=!0)}),u(14," Aggiungi PDS "),a()()(),r(15,"app-table",17),D("selectedRowsChange",function(e){l(t);let i=p();return A(i.selectedRows,e)||(i.selectedRows=e),c(e)}),a()()}if(n&2){let t=p();_(3),y(t.table.label),_(6),m("form",t.searchForm)("options",t.optionsFrom),_(4),m("disabled",!t.selectedRows.length),_(2),m("headers",t.table.headers)("data",t.filterdTableData),x("selectedRows",t.selectedRows)}}function wt(n,C){n&1&&(r(0,"h1",18),u(1,"Aggiungi PDS"),a())}function vt(n,C){if(n&1){let t=h();r(0,"search-client",21),f("select",function(e){l(t);let i=p(2);return c(i.onSelectClients(e))}),a()}}function bt(n,C){if(n&1){let t=h();r(0,"add-sconto",19),f("cancel",function(){l(t);let e=p();return c(e.showDialogNewDiscount=e.discountSelected=!1)})("submit",function(e){l(t);let i=p();return c(i.onAddNewDiscount(e))}),a(),w(1,vt,1,0,"search-client",20)}if(n&2){let t=p();m("added",t.discountSelected)("type",t.disountType),_(),m("ngIf",t.discountSelected)}}function Rt(n,C){n&1&&(r(0,"h1",18),u(1,"l'inserimento \xE8 andato con successo"),a())}function xt(n,C){if(n&1&&(r(0,"p"),u(1),a(),r(2,"p"),u(3,"Premi il tasto OK per tornare alla pagina sconto piano di supporto"),a()),n&2){let t=p();_(),y(t.dialogConfirmDetails)}}function At(n,C){if(n&1){let t=h();r(0,"div",22)(1,"button",23),f("click",function(){l(t);let e=p();return c(e.showDialogConfirm=!1)}),u(2," Annula "),a(),r(3,"a",9)(4,"button",24),R(5,"span",11),r(6,"span"),u(7,"OK"),a()()()()}}var Qt=(()=>{class n{route;router;scontiService;infoCarService;notification;store;optionsFrom;searchForm;table;filterdTableData;selectedRows;showDialogNewDiscount;showDialogConfirm;dialogConfirmDetails;discountSelected;destroySubject=new L;disountType=W.PDS;constructor(t,o,e,i,E,s){this.route=t,this.router=o,this.scontiService=e,this.infoCarService=i,this.notification=E,this.store=s,this.table={data:[],label:T,headers:N},this.filterdTableData=[]}ngOnInit(){this.selectedRows=[],this.searchForm=ut(O,this.route.snapshot.queryParams),this.subscribeAutocomplition()}onFormEvent(t){let{type:o,payload:e}=t;switch(o){case I.FormSubmit:this.onFilterSubmit(e);break;case I.FormAutocomplete:this.optionsFrom[e.name]||this.fetchAutoCompletion(e.name)}}onFilterSubmit(t){let o={},e=this.searchForm.controls.map(i=>i.name);e.filter(i=>t[i]!=null).forEach(i=>o[i]=t[i]),this.router.navigate([],{queryParams:o}),this.fetchCars(()=>{let i=s=>{for(let v of e)if(t[v]!=null&&t[v]!=""&&t[v]!=s[v])return!1;return!0},E=this.table.data.filter(i);this.filterdTableData=E})}onSelectClients(t){this.showDialogNewDiscount=!1;let o=this.selectedRows.length;this.dialogConfirmDetails="E' stato aggiunto "+(o>1?o+" sconti":"uno sconto")+" PDS con sucesso.",this.showDialogConfirm=!0}onAddNewDiscount(t){this.discountSelected=!0}fetchCars(t){let o={"X-UNIPOL-REQUESTID":crypto.randomUUID()};this.scontiService.getVeicoli(o).pipe(b(this.destroySubject)).subscribe({next:e=>{this.table={data:e,label:T,headers:N},this.filterdTableData=[...this.table.data],S.print("getScontiCostruttore","result",e),t&&t()},error:e=>{S.print("getScontiCostruttore","error",e)},complete:()=>{S.print("getScontiCostruttore","complete")}})}fetchAutoCompletion(t){this.infoCarService.autoComplete(t).pipe(b(this.destroySubject)).subscribe({next:o=>{this.store.setOptions(t,o),S.print("fetchAutoCompletion","result",t)},error:o=>{S.print("fetchAutoCompletion","error",t)},complete:()=>{S.print("fetchAutoCompletion","complete",t)}})}subscribeAutocomplition(){let t=O.controls.filter(o=>o.autocomplete).map(o=>o.name);this.store.autocomplitionOptions(t).pipe(b(this.destroySubject)).subscribe(o=>{this.optionsFrom=o})}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}static \u0275fac=function(o){return new(o||n)(d(j),d(H),d(k),d(B),d(Ct),d(ft))};static \u0275cmp=P({type:n,selectors:[["app-sconto-piano-supporto-nuovo"]],decls:13,vars:7,consts:[["header",""],["content",""],["footer",""],["class","sconto-pds-nuovo page",4,"ngIf"],[3,"visibleChange","onHide","modal","visible","contentStyle"],[3,"visibleChange","modal","visible"],[1,"sconto-pds-nuovo","page"],[1,"flex","flex-row","justify-between","items-center"],[1,"text-4xl"],["routerLink","/sconti/piano-supporto","routerLinkActive","router-link-active","routerLinkActive","router-link-active"],[1,"ur-button","flex","justify-between","items-center","gap-2"],[1,"pi","pi-arrow-left"],["clearButton","Rimuovi filtri","buttonLabel","Cerca",3,"dispacther","form","options"],[1,"action","flex"],[1,"flex","justify-start"],[1,"flex","justify-end"],["type","button",1,"ur-button","accent",3,"click","disabled"],[3,"selectedRowsChange","headers","data","selectedRows"],[1,"text-2xl"],[3,"cancel","submit","added","type"],[3,"select",4,"ngIf"],[3,"select"],[1,"flex","flex-row","w-full","justify-between","items-center"],[1,"ur-button","secondary",3,"click"],[1,"ur-button","w-full","primary","flex","justify-between","items-center","gap-2"]],template:function(o,e){if(o&1){let i=h();w(0,gt,16,7,"div",3),r(1,"p-dialog",4),D("visibleChange",function(s){return l(i),A(e.showDialogNewDiscount,s)||(e.showDialogNewDiscount=s),c(s)}),f("onHide",function(){return l(i),c(e.discountSelected=!1)}),w(2,wt,2,0,"ng-template",null,0,g)(4,bt,2,3,"ng-template",null,1,g),a(),r(6,"p-dialog",5),D("visibleChange",function(s){return l(i),A(e.showDialogConfirm,s)||(e.showDialogConfirm=s),c(s)}),w(7,Rt,2,0,"ng-template",null,0,g)(9,xt,4,1,"ng-template",null,1,g)(11,At,8,0,"ng-template",null,2,g),a()}o&2&&(m("ngIf",e.table),_(),m("modal",!0),x("visible",e.showDialogNewDiscount),m("contentStyle",F(6,ht)),_(5),m("modal",!0),x("visible",e.showDialogConfirm))},dependencies:[V,M,_t,U,dt,St,Et],styles:[".action[_ngcontent-%COMP%]{justify-content:space-between;padding-bottom:2rem}.form-group[_ngcontent-%COMP%]{flex:1 1 0}"]})}return n})();export{Qt as ScontoPianoSupportoNuovoComponent};
