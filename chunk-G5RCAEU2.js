import{a as ut}from"./chunk-GUEFMBWG.js";import{A as Q,B as q,C as X,Ha as O,Ia as ct,Ja as lt,Ka as pt,La as mt,P as z,aa as J,ba as K,ca as Y,da as $,ea as tt,fa as et,ga as ot,ha as it,ia as rt,ja as nt,ka as st,m as V,p as M,r as H,s as j,t as P,u as B,ua as at,v as U,w as k,x as W,y as Z,z as G}from"./chunk-LRR7SAV4.js";import{b as F,c as u,d as x}from"./chunk-F5O3EZP7.js";import"./chunk-XHWAPZXS.js";import{e as N,u as y}from"./chunk-MCQEVFIB.js";import{$ as a,Aa as l,Bb as b,Cb as S,Db as D,Fa as _,K as C,Ka as v,Qa as h,Qb as L,Xa as p,aa as c,db as s,eb as m,fb as g,i as I,jb as R,nb as f,ob as d,xb as A,yb as T}from"./chunk-JC545UEF.js";var _t="Crea Nuovo Sconto",dt=[J,K,Y,$,tt,et,ot,it,rt,nt,st,at],w={validators:[],controls:[j,P,B,U,k,W,Z,G,Q,q,X,z]};function Ct(n,Et){if(n&1){let t=R();s(0,"div",4)(1,"h1",5),A(2),m(),s(3,"app-form",6),f("dispacther",function(o){a(t);let i=d();return c(i.onFormEvent(o))}),m(),s(4,"div",7),g(5,"div",8),s(6,"div",9)(7,"button",10),f("click",function(){a(t);let o=d();return c(o.showDialogNewDiscount=!0)}),A(8," Aggiungi Sconto "),m()()(),s(9,"app-table",11),D("selectedRowsChange",function(o){a(t);let i=d();return S(i.selectedRows,o)||(i.selectedRows=o),c(o)}),m()()}if(n&2){let t=d();l(2),T(t.table.label),l(),p("form",t.searchForm)("options",t.optionsFrom),l(4),p("disabled",!t.selectedRows.length),l(2),p("headers",t.table.headers)("data",t.filterdTableData),b("selectedRows",t.selectedRows)}}function ft(n,Et){n&1&&(s(0,"h1",12),A(1,"Aggiungi Sconto"),m())}var Ht=(()=>{class n{scontiService;route;infoCarService;store;optionsFrom;searchForm;table;filterdTableData;showDialogNewDiscount;selectedRows;form;formSubmitted;destroySubject=new I;disountType=H.Costruttore;constructor(t,e,o,i){this.scontiService=t,this.route=e,this.infoCarService=o,this.store=i}ngOnInit(){this.selectedRows=[],this.showDialogNewDiscount=!1,this.searchForm=ct(w,this.route.snapshot.queryParams);let t={"X-UNIPOL-REQUESTID":crypto.randomUUID()};this.fetchCars(t),this.subscribeAutocomplition()}onFormEvent(t){let{type:e,payload:o}=t;switch(e){case O.FormSubmit:this.onFilterSubmit(o);break;case O.FormAutocomplete:this.optionsFrom[o.name]||this.fetchAutoCompletion(o.name)}}onFilterSubmit(t){if(!t){this.filterdTableData=this.table.data;return}let e=Object.keys(t),o=E=>{for(let r of e)if(t[r]!=null&&t[r]!=""&&t[r]!=E[r])return!1;return!0},i=this.table.data.filter(o);this.filterdTableData=i}onAddNewDiscount(t){this.showDialogNewDiscount=!1}fetchCars(t){this.scontiService.getVeicoli(t).pipe(C(this.destroySubject)).subscribe({next:e=>{this.table={data:e,label:_t,headers:dt},this.filterdTableData=[...this.table.data],u.print("getScontiCostruttore","result",e)},error:e=>{u.print("getScontiCostruttore","error",e)},complete:()=>{u.print("getScontiCostruttore","complete")}})}fetchAutoCompletion(t){this.infoCarService.autoComplete(t).pipe(C(this.destroySubject)).subscribe({next:e=>{this.store.setCarOptions(t,e),u.print("fetchAutoCompletion","result",t)},error:e=>{u.print("fetchAutoCompletion","error",t)},complete:()=>{u.print("fetchAutoCompletion","complete",t)}})}subscribeAutocomplition(){let t=w.controls.filter(e=>e.autocomplete).map(e=>e.name);this.store.subscribeCarAutoComplition(t).pipe(C(this.destroySubject)).subscribe(e=>{this.optionsFrom=e})}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}static \u0275fac=function(e){return new(e||n)(_(F),_(y),_(x),_(mt))};static \u0275cmp=v({type:n,selectors:[["app-sconto-nuovo"]],decls:5,vars:4,consts:[["header",""],["class","sconto-construttore page",4,"ngIf"],[3,"visibleChange","modal","visible"],[3,"cancel","submit","type"],[1,"sconto-construttore","page"],[1,"text-4xl"],["clearButton","Rimuovi filtri","buttonLabel","Cerca",3,"dispacther","form","options"],[1,"action","flex"],[1,"flex","justify-start"],[1,"flex","justify-end"],["type","button",1,"ur-button","accent",3,"click","disabled"],[3,"selectedRowsChange","headers","data","selectedRows"],[1,"text-2xl"]],template:function(e,o){if(e&1){let i=R();h(0,Ct,10,7,"div",1),s(1,"p-dialog",2),D("visibleChange",function(r){return a(i),S(o.showDialogNewDiscount,r)||(o.showDialogNewDiscount=r),c(r)}),h(2,ft,2,0,"ng-template",null,0,L),s(4,"add-sconto",3),f("cancel",function(){return a(i),c(o.showDialogNewDiscount=!1)})("submit",function(r){return a(i),c(o.onAddNewDiscount(r))}),m()()}e&2&&(p("ngIf",o.table),l(),p("modal",!0),b("visible",o.showDialogNewDiscount),l(3),p("type",o.disountType))},dependencies:[N,M,lt,V,ut,pt],styles:[".action[_ngcontent-%COMP%]{justify-content:space-between;padding-bottom:2rem}.form-group[_ngcontent-%COMP%]{flex:1 1 0}"]})}return n})();export{Ht as ScontoCostruttoreNuovoComponent};
