import{a as ht}from"./chunk-7ES4IRLF.js";import{a as gt}from"./chunk-WMVZP6HY.js";import{A as Y,B as $,C as tt,Ha as y,Ia as dt,Ja as ft,Ka as Ct,La as Et,P as et,aa as ot,ba as it,ca as nt,da as rt,ea as st,fa as at,ga as lt,ha as ct,ia as mt,ja as pt,ka as ut,m as B,p as U,r as W,s as Z,t as q,u as Q,ua as _t,v as G,w as K,x as X,y as z,z as J}from"./chunk-KXXKTX2T.js";import{b as P,c as C,d as k}from"./chunk-737PEWWY.js";import"./chunk-54NO2V2Q.js";import{e as V,t as j,v as M,w as H}from"./chunk-KODN66SN.js";import{$ as c,Aa as p,Bb as A,Cb as D,Db as O,Fa as d,K as w,Ka as F,Qa as S,Qb as h,Xa as u,aa as m,db as n,eb as s,fb as R,i as N,jb as v,nb as E,ob as f,xb as l,yb as I}from"./chunk-P6AE7GFT.js";var T="Crea Nuovo Sconto",x=[ot,it,nt,rt,st,at,lt,ct,mt,pt,ut,_t],L={validators:[],controls:[Z,q,Q,G,K,X,z,J,Y,$,tt,et]};function bt(r,g){if(r&1){let t=v();n(0,"div",6)(1,"div",7)(2,"h1",8),l(3),s(),n(4,"a",9)(5,"button",10),R(6,"span",11),n(7,"span"),l(8,"Indietro"),s()()()(),n(9,"app-form",12),E("dispacther",function(e){c(t);let i=f();return m(i.onFormEvent(e))}),s(),n(10,"div",13),R(11,"div",14),n(12,"div",15)(13,"button",16),E("click",function(){c(t);let e=f();return m(e.showDialogNewDiscount=!0)}),l(14," Aggiungi Sconto "),s()()(),n(15,"app-table",17),O("selectedRowsChange",function(e){c(t);let i=f();return D(i.selectedRows,e)||(i.selectedRows=e),m(e)}),s()()}if(r&2){let t=f();p(3),I(t.table.label),p(6),u("form",t.searchForm)("options",t.optionsFrom),p(4),u("disabled",!t.selectedRows.length),p(2),u("headers",t.table.headers)("data",t.filterdTableData),A("selectedRows",t.selectedRows)}}function wt(r,g){r&1&&(n(0,"h1",18),l(1,"Aggiungi Sconto"),s())}function St(r,g){r&1&&(n(0,"h1",18),l(1,"l'inserimento \xE8 andato con successo"),s())}function Rt(r,g){if(r&1&&(n(0,"p"),l(1),s(),n(2,"p"),l(3,"Premi il tasto OK per tornare alla pagina sconto custrottore."),s()),r&2){let t=f();p(),I(t.dialogConfirmDetails)}}function vt(r,g){if(r&1){let t=v();n(0,"div",19)(1,"button",20),E("click",function(){c(t);let e=f();return m(e.showDialogConfirm=!1)}),l(2," Annula "),s(),n(3,"a",9)(4,"button",21),R(5,"span",11),n(6,"span"),l(7,"OK"),s()()()()}}var Qt=(()=>{class r{scontiService;route;router;infoCarService;notification;store;optionsFrom;searchForm;table;filterdTableData;selectedRows;showDialogNewDiscount;showDialogConfirm;dialogConfirmDetails;destroySubject=new N;disountType=W.Costruttore;constructor(t,o,e,i,_,a){this.scontiService=t,this.route=o,this.router=e,this.infoCarService=i,this.notification=_,this.store=a,this.table={data:[],label:T,headers:x},this.filterdTableData=[]}ngOnInit(){this.selectedRows=[],this.showDialogNewDiscount=!1,this.searchForm=dt(L,this.route.snapshot.queryParams);let t={};this.searchForm.controls.forEach(e=>{t[e.name]=e.default}),Object.keys(t).some(e=>!!t[e])&&this.onFilterSubmit(t),this.subscribeAutocomplition()}onFormEvent(t){let{type:o,payload:e}=t;switch(o){case y.FormSubmit:this.onFilterSubmit(e);break;case y.FormAutocomplete:this.optionsFrom[e.name]||this.fetchAutoCompletion(e.name)}}onFilterSubmit(t){let o={},e=this.searchForm.controls.map(i=>i.name);e.filter(i=>t[i]!=null).forEach(i=>o[i]=t[i]),this.router.navigate([],{queryParams:o}),this.fetchCars(()=>{let i=a=>{for(let b of e)if(t[b]!=null&&t[b]!=""&&t[b]!=a[b])return!1;return!0},_=this.table.data.filter(i);this.filterdTableData=_})}onAddNewDiscount(t){this.showDialogNewDiscount=!1;let o=this.selectedRows.length;this.dialogConfirmDetails="E' stato aggiunto "+(o>1?o+" sconti":"uno sconto")+" costruttore con sucesso.",this.showDialogConfirm=!0}fetchCars(t){let o={"X-UNIPOL-REQUESTID":crypto.randomUUID()};this.scontiService.getVeicoli(o).pipe(w(this.destroySubject)).subscribe({next:e=>{this.table={data:e,label:T,headers:x},this.filterdTableData=[...this.table.data],C.print("getScontiCostruttore","result",e),t&&t()},error:e=>{C.print("getScontiCostruttore","error",e)},complete:()=>{C.print("getScontiCostruttore","complete")}})}fetchAutoCompletion(t){this.infoCarService.autoComplete(t).pipe(w(this.destroySubject)).subscribe({next:o=>{this.store.setOptions(t,o),C.print("fetchAutoCompletion","result",t)},error:o=>{C.print("fetchAutoCompletion","error",t)},complete:()=>{C.print("fetchAutoCompletion","complete",t)}})}subscribeAutocomplition(){let t=L.controls.filter(o=>o.autocomplete).map(o=>o.name);this.store.autocomplitionOptions(t).pipe(w(this.destroySubject)).subscribe(o=>{this.optionsFrom=o})}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}static \u0275fac=function(o){return new(o||r)(d(P),d(j),d(M),d(k),d(gt),d(Et))};static \u0275cmp=F({type:r,selectors:[["app-sconto-nuovo"]],decls:12,vars:6,consts:[["header",""],["content",""],["footer",""],["class","sconto-construttore-nuovo page",4,"ngIf"],[3,"visibleChange","modal","visible"],[3,"cancel","submit","type"],[1,"sconto-construttore-nuovo","page"],[1,"flex","flex-row","justify-between","items-center"],[1,"text-4xl"],["routerLink","/sconti/costruttore","routerLinkActive","router-link-active","routerLinkActive","router-link-active"],[1,"ur-button","flex","justify-between","items-center","gap-2"],[1,"pi","pi-arrow-left"],["clearButton","Rimuovi filtri","buttonLabel","Cerca",3,"dispacther","form","options"],[1,"action","flex"],[1,"flex","justify-start"],[1,"flex","justify-end"],["type","button",1,"ur-button","accent",3,"click","disabled"],[3,"selectedRowsChange","headers","data","selectedRows"],[1,"text-2xl"],[1,"flex","flex-row","w-full","justify-between","items-center"],[1,"ur-button","secondary",3,"click"],[1,"ur-button","w-full","primary","flex","justify-between","items-center","gap-2"]],template:function(o,e){if(o&1){let i=v();S(0,bt,16,7,"div",3),n(1,"p-dialog",4),O("visibleChange",function(a){return c(i),D(e.showDialogNewDiscount,a)||(e.showDialogNewDiscount=a),m(a)}),S(2,wt,2,0,"ng-template",null,0,h),n(4,"add-sconto",5),E("cancel",function(){return c(i),m(e.showDialogNewDiscount=!1)})("submit",function(a){return c(i),m(e.onAddNewDiscount(a))}),s()(),n(5,"p-dialog",4),O("visibleChange",function(a){return c(i),D(e.showDialogConfirm,a)||(e.showDialogConfirm=a),m(a)}),S(6,St,2,0,"ng-template",null,0,h)(8,Rt,4,1,"ng-template",null,1,h)(10,vt,8,0,"ng-template",null,2,h),s()}o&2&&(u("ngIf",e.table),p(),u("modal",!0),A("visible",e.showDialogNewDiscount),p(3),u("type",e.disountType),p(),u("modal",!0),A("visible",e.showDialogConfirm))},dependencies:[V,H,U,ft,B,ht,Ct],styles:[".action[_ngcontent-%COMP%]{justify-content:space-between;padding-bottom:2rem}.form-group[_ngcontent-%COMP%]{flex:1 1 0}"]})}return r})();export{Qt as ScontoCostruttoreNuovoComponent};
