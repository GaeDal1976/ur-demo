import{a as P}from"./chunk-GIGT64UM.js";import{$ as Q,Aa as X,Ba as J,Ca as K,Da as Y,Ea as Z,Fa as $,Ga as ee,Ha as R,Ia as te,Ja as oe,S as H,T as M,U as j,V as U,W as G,X as B,Y as k,Z as x,_ as W,p as N,q as T,va as V,ya as q,za as z}from"./chunk-5M4TV7DC.js";import{c as n}from"./chunk-7HSNJ7HC.js";import{C as c,G as C,I as f,O as g}from"./chunk-NWQVG56C.js";import{u as v}from"./chunk-5XZD4T2H.js";import{Aa as h,Bb as L,Cb as O,Db as w,Fa as u,K as m,Ka as y,Xa as d,a as F,db as E,eb as _,i as I,ia as S,nb as b,xb as D}from"./chunk-QIVHEG4A.js";var ie="Cerca Cliente",re=[V,X,q,J,z,K,Y,Z,$,ee],A={validators:[],controls:[G,H,j,B,k,x,Q,W]};var Se=(()=>{class l{clienetService;store;route;type;select=new S;visible=!0;searchForm;optionsFrom;selectedRows;table;filterdTableData;destroySubject=new I;constructor(e,t,o){this.clienetService=e,this.store=t,this.route=o}ngOnInit(){this.selectedRows=new Array,this.table={label:ie,headers:re,data:[]},this.filterdTableData=[],this.subscribeAutocomplition(),this.searchForm=te(A,this.route.snapshot.queryParams);let e=this.searchForm.controls.find(t=>t.name===c);e&&(this.type?(e.default=this.type,e.disabled=!0,this.onFilterChange({})):e.default=T.CapoGruppo)}onFormEvent({type:e,payload:t}){switch(e){case R.FormChange:this.onFilterChange(t);break;case R.FormSubmit:this.onFilterSubmit(t);break;case R.FormAutocomplete:this.optionsFrom[t.name]||this.fetchAutoCompletion(t.name)}}onFilterChange(e){let t=!!this.type&&!e[c];this.type&&(e[c]=this.type);let o=()=>{this.searchForm.controls.forEach(i=>i.default=e[i.name]),this.searchForm=F({},this.searchForm)},s=this.searchForm.controls.find(i=>i.name==f),r=this.searchForm.controls.find(i=>i.name==C),p=e[c];if(p!=T.Cliente&&r&&s&&(this.searchForm.controls=this.searchForm.controls.filter(i=>![f,C].includes(i.name)),t=!0),p==T.Cliente&&!r&&!s){let i=this.searchForm.controls.findIndex(a=>a.name==c);i!=-1&&(this.searchForm.controls=[...this.searchForm.controls.slice(0,i+1),M,U,...this.searchForm.controls.slice(i+1)]),t=!0}t&&o()}onFilterSubmit(e){if(!e){this.filterdTableData=this.table.data;return}this.fetchClients(e)}fetchAutoCompletion(e){this.clienetService.autoComplete(e).pipe(m(this.destroySubject)).subscribe({next:t=>{this.store.setCarOptions(e,t),n.print("fetchAutoCompletion","result",e)},error:t=>{n.print("fetchAutoCompletion","error",e)},complete:()=>{n.print("fetchAutoCompletion","complete",e)}})}subscribeAutocomplition(){let e=A.controls.filter(t=>t.autocomplete).map(t=>t.name);this.store.subscribeCarAutoComplition([...e,f,C]).pipe(m(this.destroySubject)).subscribe(t=>{this.optionsFrom=t})}fetchClients(e){let t={params:e,"X-UNIPOL-REQUESTID":crypto.randomUUID()};this.clienetService.getCliente(t).pipe(m(this.destroySubject)).subscribe({next:o=>{this.table.data=o;let s=Object.keys(e),r=i=>{for(let a of s)if(e[a]!=null&&e[a]!=""&&e[a]!=i[a])return!1;return!0},p=this.table.data.filter(r);this.filterdTableData=p,n.print("getScontiCostruttore","result",o)},error:o=>{n.print("getScontiCostruttore","error",o)},complete:()=>{n.print("getScontiCostruttore","complete")}})}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}static \u0275fac=function(t){return new(t||l)(u(P),u(g),u(v))};static \u0275cmp=y({type:l,selectors:[["search-client"]],inputs:{type:"type"},outputs:{select:"select"},decls:6,vars:7,consts:[[1,"cerca-cliente"],["clearButton","Rimuovi filtri","buttonLabel","Cerca",3,"dispacther","form","options"],[1,"action","flex","flex-row","flex-wrap","justify-end","gap-2","p-2"],["type","button",1,"ur-button","primary",3,"click","disabled"],[3,"selectedRowsChange","withoutExport","headers","data","selectedRows"]],template:function(t,o){t&1&&(E(0,"div",0)(1,"app-form",1),b("dispacther",function(r){return o.onFormEvent(r)}),_(),E(2,"div",2)(3,"button",3),b("click",function(){return o.select.emit(o.selectedRows)}),D(4," Seleziona "),_()(),E(5,"app-table",4),w("selectedRowsChange",function(r){return O(o.selectedRows,r)||(o.selectedRows=r),r}),_()()),t&2&&(h(),d("form",o.searchForm)("options",o.optionsFrom),h(2),d("disabled",!o.selectedRows.length),h(2),d("withoutExport",!0)("headers",o.table.headers)("data",o.filterdTableData),L("selectedRows",o.selectedRows))},dependencies:[oe,N],encapsulation:2})}return l})();export{Se as a};
