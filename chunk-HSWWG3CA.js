import{a as J}from"./chunk-PGZ5RUEV.js";import{a as ze,b as Xe}from"./chunk-LG3XSIQP.js";import{a as Je}from"./chunk-6GMTMCSA.js";import"./chunk-GIGT64UM.js";import{A as pe,B as _e,C as me,D as ue,E as de,F as Ee,G as Ce,H as fe,Ha as D,I as he,Ia as Ze,J as Se,Ja as Qe,K as Re,Ka as qe,M as Ae,O as Te,Q as De,R as be,aa as Ie,ba as ge,ca as ye,da as Oe,ea as we,fa as Le,ga as ve,ha as xe,ia as Fe,ja as Pe,ka as Ve,la as Ne,m as ee,ma as Me,na as He,oa as ke,p as te,pa as Ue,q as T,ra as je,s as ie,t as oe,ta as Ge,u as ne,v as re,w as ae,wa as Be,x as se,xa as We,y as le,z as ce}from"./chunk-5M4TV7DC.js";import{b as z,c as h,d as X}from"./chunk-7HSNJ7HC.js";import{D as L,E as v,G as Y,O as $,g as K,t as P}from"./chunk-NWQVG56C.js";import{e as B,i as W,u as Z,w as Q,x as q}from"./chunk-5XZD4T2H.js";import{$ as p,Aa as s,Ab as F,B as k,Bb as g,Cb as y,Db as O,Fa as R,Fb as G,K as I,Ka as U,Qa as A,Qb as w,Xa as l,a as S,aa as _,b as x,db as r,eb as a,i as H,jb as C,nb as f,ob as c,xb as m,yb as j}from"./chunk-QIVHEG4A.js";var V="Piano di supporto",N=[Be,We,Ie,ge,Oe,He,ke,Ne,Me,Ge,ye,we,Le,ve,xe,Fe,Pe,Ve,Ue,je],M={validators:[],controls:[De,be,ie,oe,ne,re,ae,se,le,ce,pe,_e,me,ue,de,Ee,Ce,fe,he,Se,Re,Ae,Te]};var Ke=()=>["nuovo"];function Ye(o,d){if(o&1&&(r(0,"h1",13),m(1),a()),o&2){let e=c();s(),j(e.table.label)}}function $e(o,d){if(o&1){let e=C();r(0,"app-form",14),f("dispacther",function(t){p(e);let n=c();return _(n.onFormEvent(t))}),a()}if(o&2){let e=c();l("form",e.searchForm)("options",e.optionsFrom)}}function et(o,d){if(o&1&&(r(0,"div",15)(1,"p-message",16),m(2),a()()),o&2){let e=c();s(2),F("\xE8 stato selezionato ",e.selectedClients.length," ",e.clientType,"")}}function tt(o,d){if(o&1){let e=C();r(0,"div",17)(1,"div",18)(2,"a",19)(3,"button",20),m(4,"Crea Nuovo PDS"),a()()(),r(5,"div",21)(6,"button",22),f("click",function(){p(e);let t=c();return _(t.showDialogEditValidityDate=!0)}),m(7," Modifica Fine Validit\xE0 "),a(),r(8,"button",22),f("click",function(){p(e);let t=c();return _(t.showDialogRemoveDiscounts=!0)}),m(9," Eliminazione PDS "),a()()()}if(o&2){let e=c();s(2),l("routerLink",G(3,Ke)),s(4),l("disabled",!e.selectedRows.length),s(2),l("disabled",!e.selectedRows.length)}}function it(o,d){if(o&1){let e=C();r(0,"app-table",23),O("selectedRowsChange",function(t){p(e);let n=c();return y(n.selectedRows,t)||(n.selectedRows=t),_(t)}),a()}if(o&2){let e=c();l("numberOfDisplayedColumns",10)("headers",e.table.headers)("data",e.filterdTableData),g("selectedRows",e.selectedRows)}}function ot(o,d){if(o&1){let e=C();r(0,"edit-validity-date-modal",24),f("cancel",function(){p(e);let t=c();return _(t.showDialogEditValidityDate=!1)})("select",function(t){p(e);let n=c();return _(n.onSelectDiscountValidity(t))}),a()}}function nt(o,d){o&1&&(r(0,"div",25)(1,"h2",26),m(2,"Elimina Sconto"),a()())}function rt(o,d){if(o&1){let e=C();r(0,"div",27)(1,"button",28),f("click",function(){p(e);let t=c();return _(t.showDialogRemoveDiscounts=!1)}),m(2," Annulla "),a(),r(3,"button",29),f("click",function(){p(e);let t=c();return _(t.onRemoveDiscounts())}),m(4," Conferma "),a()()}}function at(o,d){o&1&&(r(0,"h1",13),m(1,"Cerca Cliente"),a())}function st(o,d){if(o&1){let e=C();r(0,"search-client",30),f("select",function(t){p(e);let n=c();return _(n.onSelectClients(t))}),a()}if(o&2){let e=c();l("type",e.clientType)}}var Ft=(()=>{class o{scontiService;infoCarService;store;route;router;searchForm;optionsFrom;selectedRows;table;filterdTableData;showDialogEditValidityDate;showDialogRemoveDiscounts;showDialogSearchClient;clientType;selectedClients;destroySubject=new H;constructor(e,i,t,n,u){this.scontiService=e,this.infoCarService=i,this.store=t,this.route=n,this.router=u,this.router.navigate([],{queryParams:{}}),this.table={data:[],label:V,headers:N},this.filterdTableData=[]}ngOnInit(){this.selectedRows=new Array,this.showDialogRemoveDiscounts=!1,this.showDialogEditValidityDate=!1,this.showDialogSearchClient=!1,this.subscribeQueryParams(),this.subscribeAutocomplition()}onFormEvent({type:e,payload:i}){switch(e){case D.FormSubmit:this.onFilterSubmit(i);break;case D.FormLookup:i?.name==v&&(this.clientType=T.Cliente),i?.name==L&&(this.clientType=T.CapoGruppo),this.showDialogSearchClient=!0;break;case D.FormChange:this.onFilterChange(i);break;case D.FormAutocomplete:this.optionsFrom[i.name]||this.fetchAutoCompletion(i.name)}}onFilterChange(e){this.searchForm.controls.forEach(i=>i.default=e[i.name]),!e[v]&&!e[L]&&(this.selectedClients=null),this.searchForm=S({},this.searchForm)}onRemoveDiscounts(){this.showDialogRemoveDiscounts=!1,this.filterdTableData=this.filterdTableData.filter(e=>!this.selectedRows.find(i=>i.id==e.id)),this.selectedRows.splice(0)}onSelectDiscountValidity(e){let i=Xe.parseDateToString(e,"yyyy-MM-dd");this.showDialogEditValidityDate=!1,this.filterdTableData=this.filterdTableData.map(t=>this.selectedRows.find(n=>n.id==t.id)?x(S({},t),{[P]:i}):t),this.selectedRows=this.selectedRows.map(t=>x(S({},t),{[P]:i}))}onSelectClients(e){let i="Selezione Multipla";if(e.length==1){let n=this.clientType==T.Cliente?Y:K;i=e[0][n]}this.showDialogSearchClient=!1,this.selectedClients=e;let t=this.clientType==T.Cliente?v:L;this.onFilterChange({[t]:i})}onFilterSubmit(e){let i={},t=this.searchForm.controls.map(n=>n.name);t.filter(n=>e[n]!=null).forEach(n=>i[n]=e[n]),this.router.navigate([],{queryParams:i}),this.store.setParamsPDS(i),this.fetchScontiDS(()=>{let n=E=>{for(let b of t)if(e[b]!=null&&e[b]!=""&&e[b]!=E[b])return!1;return!0},u=this.table.data.filter(n);this.filterdTableData=u})}fetchScontiDS(e){let i={"X-UNIPOL-REQUESTID":crypto.randomUUID()};this.scontiService.getScontipianoDiSupporto(i).pipe(I(this.destroySubject)).subscribe({next:t=>{this.table={data:t,label:V,headers:N},this.filterdTableData=[...t],h.print("getScontiCostruttore","result",t),e&&e()},error:t=>{h.print("getScontiCostruttore","error",t)},complete:()=>{h.print("getScontiCostruttore","complete")}})}fetchAutoCompletion(e){this.infoCarService.autoComplete(e).pipe(I(this.destroySubject)).subscribe({next:i=>{this.store.setCarOptions(e,i),h.print("fetchAutoCompletion","result",e)},error:i=>{h.print("fetchAutoCompletion","error",e)},complete:()=>{h.print("fetchAutoCompletion","complete",e)}})}subscribeAutocomplition(){let e=M.controls.filter(i=>i.autocomplete).map(i=>i.name);this.store.subscribeCarAutoComplition(e).pipe(I(this.destroySubject)).subscribe(i=>{this.optionsFrom=i})}subscribeQueryParams(){this.store.subscribeParamsPDS().pipe(k(1)).subscribe(e=>{let i=S(S({},e),this.route.snapshot.queryParams);this.searchForm=Ze(M,i);let t={};this.searchForm.controls.forEach(u=>{t[u.name]=u.default}),Object.keys(t).some(u=>!!t[u])&&this.onFilterSubmit(t)})}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}static \u0275fac=function(i){return new(i||o)(R(z),R(X),R($),R(Z),R(Q))};static \u0275cmp=U({type:o,selectors:[["app-sconti-piano-supporto"]],decls:21,vars:13,consts:[["header",""],["footer",""],[1,"sconto-pds","page"],["class","text-4xl",4,"ngIf"],["clearButton","Rimuovi filtri","buttonLabel","Cerca",3,"form","options","dispacther",4,"ngIf"],["class","pb-4",4,"ngIf"],["class","action flex",4,"ngIf"],[3,"numberOfDisplayedColumns","headers","data","selectedRows","selectedRowsChange",4,"ngIf"],[3,"cancel","select",4,"ngIf"],[3,"visibleChange","modal","visible"],[1,"flex","flex-col","gap-4","mb-4"],[1,"mb-3"],[3,"type","select",4,"ngIf"],[1,"text-4xl"],["clearButton","Rimuovi filtri","buttonLabel","Cerca",3,"dispacther","form","options"],[1,"pb-4"],["icon","pi pi-check-circle","severity","info","variant","outlined"],[1,"action","flex"],[1,"flex","gap-2","justify-start"],["routerLinkActive","router-link-active",1,"ur-a",3,"routerLink"],[1,"ur-button","accent"],[1,"flex","gap-2","justify-end"],["type","button",1,"ur-button","secondary",3,"click","disabled"],[3,"selectedRowsChange","numberOfDisplayedColumns","headers","data","selectedRows"],[3,"cancel","select"],[1,"inline-flex","items-center","justify-center","gap-2"],[1,"text-2xl"],[1,"flex","justify-between","w-full"],["type","button",1,"ur-button","secondary",3,"click"],["type","button",1,"ur-button","accent",3,"click"],[3,"select","type"]],template:function(i,t){if(i&1){let n=C();r(0,"div",2),A(1,Ye,2,1,"h1",3)(2,$e,1,2,"app-form",4)(3,et,3,2,"div",5)(4,tt,10,4,"div",6)(5,it,1,4,"app-table",7),a(),A(6,ot,1,0,"edit-validity-date-modal",8),r(7,"p-dialog",9),O("visibleChange",function(E){return p(n),y(t.showDialogRemoveDiscounts,E)||(t.showDialogRemoveDiscounts=E),_(E)}),A(8,nt,3,0,"ng-template",null,0,w),r(10,"div",10)(11,"p",11),m(12,"Verr\xE0 Eliminato lo sconto da CPQ !"),a(),r(13,"p",11),m(14),a()(),A(15,rt,5,0,"ng-template",null,1,w),a(),r(17,"p-dialog",9),O("visibleChange",function(E){return p(n),y(t.showDialogSearchClient,E)||(t.showDialogSearchClient=E),_(E)}),A(18,at,2,0,"ng-template",null,0,w)(20,st,1,1,"search-client",12),a()}i&2&&(s(),l("ngIf",t.table),s(),l("ngIf",t.searchForm),s(),l("ngIf",t.selectedClients),s(),l("ngIf",t.table),s(),l("ngIf",t.table),s(),l("ngIf",t.showDialogEditValidityDate),s(),l("modal",!0),g("visible",t.showDialogRemoveDiscounts),s(7),F(" Hai selezionato ",t.selectedRows.length," ",t.selectedRows.length==1?"sconto":"sconti"," "),s(3),l("modal",!0),g("visible",t.showDialogSearchClient),s(3),l("ngIf",t.showDialogSearchClient))},dependencies:[W,B,Qe,qe,ee,q,te,ze,Je,J],styles:[".action[_ngcontent-%COMP%]{justify-content:space-between;padding-bottom:2rem}.form-group[_ngcontent-%COMP%]{flex:1 1 0}"]})}return o})();export{Ft as ScontiPianoSupportoComponent};
